<div id="deviceBuildOperate" class="easyui-layout" xmlns="http://www.w3.org/1999/html">
    <div id="a" data-options="region:'center',border:false">
        <form id="form1" cy-form="formData1">
            <div id="aa" class="easyui-accordion">
                <div title="设备申报信息" style="overflow:auto;padding:10px;height: 450px;">
                    <div class="table">
                        <div class="tr">
                            <div class="th">申报单位：</div>
                            <div class="td">
                                <input id="department" class="easyui-combotree" name="department" style="width: 530px"/>
                            </div>
                        </div>
                        <div class="tr">
                            <div class="th">联系人：</div>
                            <div class="td">
                                <input class="easyui-textbox" name="people" style="width: 220px"/>
                            </div>
                            <div class="th">联系方式：</div>
                            <div class="td">
                                <input class="easyui-textbox" name="phone" style="width: 220px"/>
                            </div>
                        </div>
                        <div class="tr new-tr">
                            <div class="th">申报内容：</div>
                            <div class="td">
                                <input name="content" type="radio"/>新增测速设备
                            </div>
                            <div class="td">
                                <input name="content" type="radio"/>新增区间测速路段
                            </div>
                        </div>
                        <div class="tr new-tr">
                            <div class="th"></div>
                            <div class="td">
                                <input name="content" type="radio"/>新增闯红灯自动记录设备
                            </div>
                            <div class="td">
                                <input name="content" type="radio"/>新增固定视频取证设备
                            </div>
                        </div>
                        <div class="tr new-tr">
                            <div class="th"></div>
                            <div class="td">
                                <input name="content" type="radio"/>新增公路车辆智能监测记录（卡口）设备
                            </div>
                        </div>
                        <div class="tr new-tr">
                            <div class="th"></div>
                            <div class="td">
                                <input name="content" type="radio"/>新增违反禁行规定自动记录设备
                            </div>
                            <div class="td">
                                <input name="content" type="radio"/>其他
                            </div>
                        </div>
                        <div class="tr new-tr">
                            <div class="th">类型：</div>
                            <div class="td">
                                <input name="type" type="radio"/>城区非快速路设备
                            </div>
                            <div class="td">
                                <input name="type" type="radio"/>公路非执法设备
                            </div>
                        </div>
                        <div class="tr new-tr">
                            <div class="th"></div>
                            <div class="td">
                                <input name="type" type="radio"/>城区快速路设备
                            </div>
                            <div class="td">
                                <input name="type" type="radio"/>公路执法设备
                            </div>
                        </div>
                        <div class="tr new-tr">
                             <div class="th"></div>
                             <div class="td">
                                 <input name="type" type="radio"/>移动（移动点、车载）设备
                             </div>
                        </div>
                        <div class="tr">
                            <div class="th">道路名称：</div>
                            <div class="td">
                                <input class="easyui-combobox" name="" style="width: 220px;"/>
                            </div>
                            <div class="th">路口路段：</div>
                            <div class="td">
                                <input class="easyui-combobox" name="" style="width: 220px;"/>
                            </div>
                        </div>
                        <div class="tr">
                            <div class="th">米数：</div>
                            <div class="td">
                                <input class="easyui-textbox" name=""style="width: 200px;"/>(米)
                            </div>
                            <div class="th">设备名称：</div>
                            <div class="td">
                                <input class="easyui-textbox" name="" style="width: 220px;"/>
                            </div>
                        </div>
                        <div class="tr">
                            <div class="th">限高速(KM/H)：</div>
                            <div class="td" style="width: 40px; text-align: right">
                                大车
                            </div>
                            <div class="td">
                                <input class="easyui-textbox" name="" style="width: 92px;"/>
                            </div>
                            <div class="td" style="width: 40px; text-align: right">
                                小车
                            </div>
                            <div class="td">
                                <input class="easyui-textbox" name="" style="width: 92px;"/>
                            </div>
                            <div class="td" style="width: 40px; text-align: right">
                                摩托车
                            </div>
                            <div class="td">
                                <input class="easyui-textbox" name="" style="width: 92px;"/>
                            </div>
                            <div class="td" style="width: 40px; text-align: right">
                                其他车
                            </div>
                            <div class="td">
                                <input class="easyui-textbox" name="" style="width: 92px;"/>
                            </div>
                        </div>
                        <div class="tr">
                            <div class="th">道路类型：</div>
                            <div class="td">
                                <input class="easyui-combobox" name="" style="width: 220px;"/>
                            </div>
                            <div class="th">道路行政等级：</div>
                            <div class="td">
                                <input class="easyui-combobox" name="" style="width: 220px;"/>
                            </div>
                        </div>
                        <div class="tr">
                            <div class="th">道路路面等级：</div>
                            <div class="td">
                                <input class="easyui-combobox" name="" style="width: 220px;"/>
                            </div>
                            <div class="th">线形或地形：</div>
                            <div class="td">
                                <input class="easyui-combobox" name="" style="width: 220px;"/>
                            </div>
                        </div>
                        <div class="tr">
                            <div class="th">设备经度：</div>
                            <div class="td">
                                <input class="easyui-textbox" name="" style="width: 130px;"/>(0~180.000000)
                            </div>
                            <div class="th">设备纬度：</div>
                            <div class="td">
                                <input class="easyui-textbox" name="" style="width: 130px;"/>(0~90.000000)
                            </div>
                        </div>
                        <div class="tr">
                            <div class="th">设置理由：</div>
                            <div class="td">
                                <input class="easyui-textbox" data-options="multiline:true" name="" style="width:530px;height:60px"/>
                            </div>
                        </div>
                        <div class="tr">
                            <div class="th">设置位置满足：</div>
                            <div class="td new-td">
                                <input type="checkbox" name=""/>是否设置于省、州（市）、县际公路交界处
                            </div>
                        </div>
                        <div class="tr">
                            <div class="th"></div>
                            <div class="td new-td">
                                <input type="checkbox" name=""/>是否设置于连续弯道、隧道、长坡、临江、临崖、大型桥梁等危险路段
                            </div>
                        </div>
                        <div class="tr">
                            <div class="th"></div>
                            <div class="td new-td">
                                <input type="checkbox" name=""/>是否设置于交通事故多发或存在较严重交通安全隐患的路口、路段
                            </div>
                        </div>
                        <div class="tr">
                            <div class="th"></div>
                            <div class="td new-td">
                                <input type="checkbox" name=""/>是否设置于道路情况复杂，通行秩序较乱，需要实施管控的路口、路段
                            </div>
                        </div>
                        <div class="tr">
                            <div class="th">设备是否满足：</div>
                            <div class="td">
                                <strong style="font-size: 15px;">固定点：</strong>
                            </div>
                        </div>
                        <div class="tr">
                            <div class="th"></div>
                            <div class="td new-td">
                                <input type="checkbox" name=""/>
                                同方向道路上设置固定式测速监控设备：普通公路间距应大于10公里；高等级公路间距应大于20公里；高速公路间距应大于30公里
                            </div>
                        </div>
                        <div class="tr">
                            <div class="th"></div>
                            <div class="td new-td">
                                <input type="checkbox" name=""/>
                                设置固定式测速设备的路段限速值：城市快速路、高速公路应当不小于70公里/小时；其他道路应当不小于50公里/小时
                            </div>
                        </div>
                        <div class="tr">
                            <div class="th"></div>
                            <div class="td new-td">
                                <input type="checkbox" name=""/>
                                除法律法规明确规定车辆通行速度的道路外：设置固定式测速监控设备的路段应当设有清楚明
                                确的限速标志，并设置在限速标志起始点后500米至解除限速标志或下一限速标志之间
                            </div>
                        </div>
                        <div class="tr">
                            <div class="th"></div>
                            <div class="td new-td">
                                <input type="checkbox" name=""/>除城市快速路外，不得在其他城市道路设置固定测速监控设备
                            </div>
                        </div>
                        <div class="tr">
                            <div class="th"></div>
                            <div class="td">
                                <strong style="font-size: 15px;">区间：</strong>
                            </div>
                        </div>
                        <div class="tr">
                            <div class="th"></div>
                            <div class="td new-td">
                                <input type="checkbox" name=""/>
                                1.设置区间测速设备的路段限速值应当恒定，且限值高速公路、城市快速路应当不小于70公里/小时，其他道路不小于60公里/小时
                            </div>
                        </div>
                        <div class="tr">
                            <div class="th"></div>
                            <div class="td new-td">
                                <input type="checkbox" name=""/>2.测速区间应当不大于15公里，区间内应当无交叉路口、服务区等
                            </div>
                        </div>
                        <div class="tr">
                            <div class="th"></div>
                            <div class="td new-td">
                                <input type="checkbox" name=""/>3.设置区间的测速监控设备的路段应当设有清楚明确的限速标志
                            </div>
                        </div>
                        <div class="tr">
                            <div class="th"></div>
                            <div class="td">
                                <strong style="font-size: 15px;">移动点：</strong>
                            </div>
                        </div>
                        <div class="tr">
                            <div class="th"></div>
                            <div class="td new-td">
                                <input type="checkbox" name=""/>
                                    （一）在来车方向距离测速点500米以外应当有明显的限速标志
                            </div>
                        </div>
                        <div class="tr">
                            <div class="th"></div>
                            <div class="td new-td">
                                <input type="checkbox" name=""/>
                                    （二）移动测速监控设备应当放置于路侧明显位置，不得无故遮挡或掩盖；应选择安全的地点，不得影响其他车辆的正常通行
                            </div>
                        </div>
                        <div class="tr">
                            <div class="th"></div>
                            <div class="td new-td">
                                <input type="checkbox" name=""/>
                                （三）使用移动测速监控设备应当现场处理超速违法行为，测速点和查处点之间的距离不少于2000米；
                                 在高速公路上现场查处违法限速规定交违法行为的，查处点应当设置在收费站、服务区等场所
                            </div>
                        </div>
                        <div class="tr">
                            <div class="th"></div>
                            <div class="td new-td">
                                <input type="checkbox" name=""/>
                                （四）使用移动测速监控设备应当由交通警察操作；使用车载移动测速监控设备的，应当使用>制式警车，
                                夜间测速应当开启警灯
                            </div>
                        </div>
                        <div class="tr">
                            <div class="th"></div>
                            <div class="td new-td">
                                <input type="checkbox" name=""/>
                                （五）已设有固定测速监控设备的路段不得设置移动测速监控设备；移动测速监控设备与固定
                                测速监控设备距离应当符合第十一条第（一）款规定
                            </div>
                        </div>
                        <div class="tr">
                            <div class="th"></div>
                            <div class="td new-td">
                                <input type="checkbox" name=""/>
                                （六）严禁以流动测速监控设备代替固定测速监控设备长期定点使用；除城市快速路外，不得
                                在其他城市道路设置移动测速监控设备
                            </div>
                        </div>
                    </div>
                </div>
                <div title="总队审核" style="overflow:auto;padding:10px;height: 450px;">
                    <div class="table new-table">
                        <form id="form2" cy-form="formData2">
                            <div class="tr">
                                <div class="th">总队审核<br/>意见：</div>
                                <div class="td">
                                    <input class="easyui-textbox" data-options="multiline:true" name="" style="width:530px;height:60px"/>
                                </div>
                            </div>
                            <div class="tr">
                                <div class="th">附件：</div>
                                <div class="td">
                                    <input class="easyui-filebox" data-options="buttonText:'选择文件'" name=""  style="width: 230px"/>
                                </div>
                            </div>
                            <div class="tr">
                                <div class="th">审核人：</div>
                                <div class="td">
                                    <input class="easyui-textbox" name="" style="width: 230px"/>
                                </div>
                                <div class="th">审核时间：</div>
                                <div class="td">
                                    <input class="easyui-datebox" name="" style="width: 230px"/>
                                </div>
                            </div>
                            <div class="tr">
                                <div class="linkbutton_toolbar" style="text-align: center">
                                    <a class="easyui-linkbutton button-save" data-options="iconCls:'icon-save'" cy-click="teamSave">提交</a>
                                </div>
                            </div>
                        </form>
                        <div class="tr">
                            <div class="td" style="width: 300px;">
                                <div class="table">
                                    <form id="form3" cy-form="formData3">
                                        <div class="tr">
                                            <div class="th">总队业务部<br/>门审核：</div>
                                            <div class="td">
                                                <input class="easyui-textbox" data-options="multiline:true" name="" style="width:230px;height:60px"/>
                                            </div>
                                        </div>
                                        <div class="tr">
                                            <div class="th">附件：</div>
                                            <div class="td">
                                                <input class="easyui-filebox" data-options="buttonText:'选择文件'" name="" style="width: 230px"/>
                                            </div>
                                        </div>
                                        <div class="tr">
                                            <div class="th">审核人：</div>
                                            <div class="td">
                                                <input class="easyui-textbox" name="" style="width: 70px"/>
                                            </div>
                                            <div class="th">审核时间：</div>
                                            <div class="td">
                                                <input class="easyui-datebox" name="" style="width: 95px"/>
                                            </div>
                                        </div>
                                        <div class="tr">
                                            <div class="linkbutton_toolbar" style="text-align: center">
                                                <a class="easyui-linkbutton button-save" data-options="iconCls:'icon-save'" cy-click="teamBusinessSave">提交</a>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            <div class="td" style="width: 300px;">
                                <div class="table">
                                    <form id="form4" cy-form="formData4">
                                        <div class="tr">
                                            <div class="th">总队技术部<br/>门审核：</div>
                                            <div class="td">
                                                <input class="easyui-textbox" data-options="multiline:true" name="" style="width:230px;height:60px"/>
                                            </div>
                                        </div>
                                        <div class="tr">
                                            <div class="th">附件：</div>
                                            <div class="td">
                                                <input class="easyui-filebox" data-options="buttonText:'选择文件'" name="" style="width: 230px"/>
                                            </div>
                                        </div>
                                        <div class="tr">
                                            <div class="th">审核人：</div>
                                            <div class="td">
                                                <input class="easyui-textbox" name="" style="width: 70px"/>
                                            </div>
                                            <div class="th">审核时间：</div>
                                            <div class="td">
                                                <input class="easyui-datebox" name="" style="width: 95px"/>
                                            </div>
                                        </div>
                                        <div class="tr">
                                            <div class="linkbutton_toolbar" style="text-align: center">
                                                <a class="easyui-linkbutton button-save" data-options="iconCls:'icon-save'" cy-click="teamTechnologySave">提交</a>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div title="支队审核" style="overflow:auto;padding:10px;height: 450px;">
                    <div class="table new-table">
                        <form id="form5" cy-form="formData5">
                            <div class="tr">
                                <div class="th">支队审核<br/>意见：</div>
                                <div class="td">
                                    <input class="easyui-textbox" data-options="multiline:true" name="" style="width:530px;height:60px"/>
                                </div>
                            </div>
                            <div class="tr">
                                <div class="th">附件：</div>
                                <div class="td">
                                    <input class="easyui-filebox" data-options="buttonText:'选择文件'" name="" style="width: 230px"/>
                                </div>
                            </div>
                            <div class="tr">
                                <div class="th">审核人：</div>
                                <div class="td">
                                    <input class="easyui-textbox" name="" style="width: 230px"/>
                                </div>
                                <div class="th">审核时间：</div>
                                <div class="td">
                                    <input class="easyui-datebox" name="" style="width: 230px"/>
                                </div>
                            </div>
                            <div class="tr">
                                <div class="linkbutton_toolbar" style="text-align: center">
                                    <a class="easyui-linkbutton button-save" data-options="iconCls:'icon-save'" cy-click="detachmentSave">提交</a>
                                </div>
                            </div>
                        </form>
                        <div class="tr">
                            <div class="td" style="width: 300px;">
                                <div class="table">
                                    <form id="form6" cy-form="formData6">
                                        <div class="tr">
                                            <div class="th">支队业务部<br/>门审核：</div>
                                            <div class="td">
                                                <input class="easyui-textbox" data-options="multiline:true" name="" style="width:230px;height:60px"/>
                                            </div>
                                        </div>
                                        <div class="tr">
                                            <div class="th">附件：</div>
                                            <div class="td">
                                                <input class="easyui-filebox" data-options="buttonText:'选择文件'" name="" style="width: 230px"/>
                                            </div>
                                        </div>
                                        <div class="tr">
                                            <div class="th">审核人：</div>
                                            <div class="td">
                                                <input class="easyui-textbox" name="" style="width: 70px"/>
                                            </div>
                                            <div class="th">审核时间：</div>
                                            <div class="td">
                                                <input class="easyui-datebox" name="" style="width: 95px"/>
                                            </div>
                                        </div>
                                        <div class="tr">
                                            <div class="linkbutton_toolbar" style="text-align: center">
                                                <a class="easyui-linkbutton button-save" data-options="iconCls:'icon-save'" cy-click="detachmentBusinessSave">提交</a>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            <div class="td" style="width: 300px;">
                                <div class="table">
                                    <form id="form7" cy-form="formData7">
                                        <div class="tr">
                                            <div class="th">支队技术部<br/>门审核：</div>
                                            <div class="td">
                                                <input class="easyui-textbox" data-options="multiline:true" name="" style="width:230px;height:60px"/>
                                            </div>
                                        </div>
                                        <div class="tr">
                                            <div class="th">附件：</div>
                                            <div class="td">
                                                <input class="easyui-filebox" data-options="buttonText:'选择文件'" name="" style="width: 230px"/>
                                            </div>
                                        </div>
                                        <div class="tr">
                                            <div class="th">审核人：</div>
                                            <div class="td">
                                                <input class="easyui-textbox" name="" style="width: 70px"/>
                                            </div>
                                            <div class="th">审核时间：</div>
                                            <div class="td">
                                                <input class="easyui-datebox" name="" style="width: 95px"/>
                                            </div>
                                        </div>
                                        <div class="tr">
                                            <div class="linkbutton_toolbar" style="text-align: center">
                                                <a class="easyui-linkbutton button-save" data-options="iconCls:'icon-save'" cy-click="detachmentTechnologySave">提交</a>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div title="其他" style="overflow:auto;padding:10px;height: 450px;">
                    <div class="table">
                        <div class="tr">
                            <div class="th">技术方案附件：</div>
                            <div class="td">
                                <input class="easyui-filebox" data-options="buttonText:'选择文件'" name="" style="width: 230px"/>
                            </div>
                        </div>
                        <div class="tr">
                            <div class="td" style="width: 300px;text-align: center;">道路概况照片</div>
                            <div class="td" style="width: 300px;text-align: center;">申报单位盖章</div>
                        </div>
                        <div class="tr">
                            <div class="td" style="width: 290px;border: 1px solid silver;">
                                <div id="photoDiv">

                                </div>
                                <div id="upDevicePhotoTemDiv" class='imgDiv' style="width: 130px;height: 130px">
                                    <img id="upDevicePhoto" src="themes/default/images/upload.png">
                                </div>
                            </div>
                            <div class="td">
                                <div id="up" class='chapterImg'>
                                    <img id="upPhoto" src="themes/default/images/noPic.jpg" style="width: 200px;height: 150px">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <div data-options="region:'south',border:false">
        <div class="linkbutton_toolbar" style="text-align: center">
            <a class="easyui-linkbutton button-save" data-options="iconCls:'icon-save'" cy-click="saveOrUpdate">保存</a>
            <a class="easyui-linkbutton button-cancel" data-options="iconCls:'icon-cancel'" cy-click="destroyTab1">取消</a>
        </div>
    </div>
</div>
<script type="text/javascript">
    InitPage(["dicts","department","destroyTab1"],function($scope){
        $scope.$("#department").combotree("loadData",$scope.department);
        $scope.load = function(){
            //初始化文件上传组件
            $scope.uploader = initUpload();
            $scope.uploader.init();//调用文件上传组件初始化方法
            $scope.imageFiles = {};//保存文件对象
            $scope.imageUrls = {};//保存文件URL
        };
        /**
         * 初始化文件上传
         * @return {[type]} [description]
         */
        function initUpload(){
            return new plupload.Uploader({
                runtimes : 'html5',
                browse_button : $scope.$("#upDevicePhoto")[0], // you can pass in id...
                container: $scope.$("#upDevicePhotoTemDiv")[0], // ... or DOM Element itself
                url : 'upload.php',
                filters : {
                    max_file_size : '10mb',
                    prevent_duplicates : true, //不允许选取重复文件
                    mime_types: [
                        {title : "照片文件", extensions : "jpg,png,jpeg,bmp,gif"}
                    ]
                },
                init: {
                    PostInit: function() {

                    },
                    FilesAdded: function(up, files) {
                        for(var index=0; index<files.length; index++){
                            var file = files[index];
                            //请按照文件名的形式，存储文件信息到页面变量中
                            parseImageFile(file);
                        }
                    },
                    Error: function(up, err) {
                        console.log(err);
                    }
                }
            });
        }
        /**
         * 获得图片文件的路径
         * @return {[type]} [description]
         */
        function parseImageFile(file){
            var name = file.name;
            $scope.imageFiles[name]=file;
            var reader = new FileReader();
            reader.readAsDataURL(file.getSource().getSource());
            reader.onload = function(e){
                $scope.imageUrls[name]=this.result;
                var imgDiv=$("<div class='imgDiv'></div>");
                var img=$("<img style='width: 130px;height: 130px'/>");
                img.attr("src",this.result);
                imgDiv.append(img);
                var deleteDiv=$("<div style='margin-left: 50px;cursor: pointer'><a class='easyui-linkbutton button-remove'>删除</a></div>");
                deleteDiv.click(function()
                {
                    //把这个div删除
                    $(this).parent().remove();
                    //把文件队列中文件删除
                    $scope.uploader.removeFile(file);
                });
                imgDiv.append(deleteDiv);
                $scope.$("#photoDiv").append(imgDiv);
            };
        }

        /**
         * 总队技术部门提交审批表
         */
        $scope.teamTechnologySave = function(){
            $scope.$openDialog("leadershipAudit",{
                title:"申请表 提交下一级审核人",
                width:400,
                height:300,
                href:"tpls/deviceManage/deviceSystemApplicationEndorsement/deviceApplicationEndorsement/leadership-audit.html"
            });
        };
        /**
         * 总队业务部门提交审批表
         */
        $scope.teamBusinessSave = function(){
            $scope.$openDialog("leadershipAudit",{
                title:"申请表 提交下一级审核人",
                width:400,
                height:300,
                href:"tpls/deviceManage/deviceSystemApplicationEndorsement/deviceApplicationEndorsement/leadership-audit.html"
            });
        };
        /**
         * 支队技术部门提交审批表
         */
        $scope.detachmentTechnologySave = function(){
            $scope.$openDialog("departmentAudit",{
                title:"申请表 提交下一级审核人",
                width:400,
                height:300,
                href:"tpls/deviceManage/deviceSystemApplicationEndorsement/deviceApplicationEndorsement/department-audit.html"
            });
        };
        /**
         * 支队业务部门提交审批表
         */
        $scope.detachmentBusinessSave = function(){
            $scope.$openDialog("departmentAudit",{
                title:"申请表 提交下一级审核人",
                width:400,
                height:300,
                href:"tpls/deviceManage/deviceSystemApplicationEndorsement/deviceApplicationEndorsement/department-audit.html"
            });
        };
    });
</script>
<style type="text/css">
    #deviceBuildOperate .td{
        white-space: normal;
        height:auto;
    }
    #deviceBuildOperate  .new-td{
        width: 540px;
    }

    #deviceBuildOperate .th{
        width: 90px;
        text-align: right;
    }
    #deviceBuildOperate .new-tr .td{
        width: 260px;
    }
    #deviceBuildOperate .new-table .th{
        width: 65px;
    }
    #deviceBuildOperate .imgDiv{
        float: left;
        border: dashed 1px silver;
        margin: 5px;
        height: 130px;
        width: 130px
    }
    #deviceBuildOperate .chapterImg{
        border: dashed 1px silver;
        margin-left: 60px;
        height: 150px;
        width: 200px
    }
</style>