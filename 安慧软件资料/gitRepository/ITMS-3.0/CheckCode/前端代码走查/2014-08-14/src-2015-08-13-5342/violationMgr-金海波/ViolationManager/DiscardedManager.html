
<div class="divView" id="queryView" style="height: 100%;">
    <div class="easyui-layout" style="height: 100%;width: 100%">
        <div data-options="region:'north'">
            <div class="toolbar" style="float:left;width:100%;clear: both">
                <form id="frmCond" class="searchForm" method="post">
                    <div class="searchPanel">
                        <div class="panel_title">查询条件</div>
                        <div class="table">
                            <div class="tr" style="text-align: center">
                                <div class="th">违法类型:</div>
                                <div class="td">
                                    <input class="easyui-combobox" id="cmbViolationTypeQ" name="ViolationType"
                                           data-options="valueField:'ID',textField:'NAME',panelHeight:'auto'"/>
                                </div>
                                <div class="th">采集机构:</div>
                                <div class="td">
                                    <input class="easyui-combobox" id="cmbOrgQ"
                                           data-options="valueField:'ID',textField:'NAME',panelHeight:'auto'"/>
                                    </select>
                                </div>
                                <div class="th">采集设备:</div>
                                <div class="td">
                                    <input class="easyui-combobox" id="cmbDeviceQ" name="ViolationType"
                                           data-options="valueField:'ID',textField:'NAME',panelHeight:'auto'"/>
                                </div>
                                <div class="th">违法时间:</div>
                                <div class="td">
                                    <input class="easyui-datebox" type="text" name="VioTimeFrom"/>
                                </div>
                                <div class="th">到</div>
                                <div class="td">
                                    <input class="easyui-datebox" type="text" name="VioTimeTo"/>
                                </div>
                            </div>
                            <div class="tr">
                                <div class="th">废弃类别:</div>
                                <div class="td">
                                    <input class="easyui-combobox" id="cmbEnforcementCategoryQ"
                                           data-options="valueField:'ID',textField:'NAME',panelHeight:'auto'"/>
                                    </select>
                                </div>
                                <div class="th">废弃原因:</div>
                                <div class="td">
                                    <input class="easyui-combobox" id="cmbDiscardTypeQ" name="ViolationType"
                                           data-options="valueField:'ID',textField:'NAME',panelHeight:'auto'"/>
                                </div>
                                <div class="th">特殊类型:</div>
                                <div class="td">
                                    <input class="easyui-combobox" id="cmbSpecialTypeQ" name="ViolationType"
                                           data-options="valueField:'ID',textField:'NAME',panelHeight:'auto'"/>
                                </div>
                                <div class="th">号牌号码:</div>
                                <div class="td">
                                    <input class="easyui-textbox" name="PlateNbr">
                                </div>
                                <div class="th">号牌种类:</div>
                                <div class="td">
                                    <input class="easyui-combobox" id="cmbPlateTypeQ" name="PlateType"
                                           data-options="valueField:'ID',textField:'NAME',panelHeight:'auto'"/>
                                </div>
                            </div>
                        </div>
                        <div class="tr" style="float: right">

                            <a href="#" class="easyui-linkbutton button-search" style="width: 80px"
                               cy-click="SearchAsync()" iconCls="icon-search ">全选</a>

                            <a href="#" class="easyui-linkbutton button-search" style="width: 80px"
                               cy-click="SearchAsync()" iconCls="icon-search ">彻底删除</a>

                            <a href="#" class="easyui-linkbutton button-search" style="width: 80px"
                               cy-click="SearchAsync()" iconCls="icon-search ">还原</a>

                            <a href="#" class="easyui-linkbutton button-search" style="width: 80px"
                               cy-click="SearchAsync()" iconCls="icon-search ">查询</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div data-options="region:'center'">
            <table id="tbVio" cy-datagrid="options" cy-querydata="formData" cy-url="data/violationMgr/violation.json">
            </table>
        </div>

        <div data-options="region:'east'" style="width: 250px">
            <div style="overflow-y: auto;height: auto;width:250px;">
                <img style="width: 100%;height: 100%" src="themes/default/images/nopic.jpg"/>
                <img style="width: 100%;height: 100%" src="themes/default/images/nopic.jpg"/>
                <img style="width: 100%;height: 100%" src="themes/default/images/nopic.jpg"/>
            </div>
        </div>
    </div>
</div>

<div class="divView" id="detailView" style="height:100%;display: none;">

<!--上边图片-->
<div class="row tr" style="height: 450px">
    <img style="width: 49%;height: 100%" src="themes/default/images/nopic.jpg"/>
    <img style="width: 49%;height: 100%" src="themes/default/images/nopic.jpg"/>
</div>
<!--中部详细-->
<div data-options="region:'east'" style="width: 100%;height: 300px;">
<form cy-form="frmDetail" method="post">
<!--车辆信息-->
<div class="portlet col-5"  style="float: right;">
    <div class="portlet-body">

        <div class="row tr" style="display: none">
            <input name="VIOLATION_ID" type="text"/>
        </div>
        <div class=" row tr">
            <div class="td col-2">号牌号码：</div>
            <div class="td col-4">
                <input class="inputlabel" name="PLATE_NBR" type="text" />
            </div>
            <div class="td col-2">号牌种类：</div>
            <div class="td col-4">
                <input class="easyui-combobox" id="cmbPlateType" name="PLATE_TYPE"
                       data-options="valueField:'ID',textField:'NAME',panelHeight:'auto'"/>
            </div>
        </div>
        <div class=" row tr">
            <div class="td col-2">号牌颜色：</div>
            <div class="td col-4">
                <input class="easyui-combobox" id="cmbPlateColor" name="PLATE_COLOR"
                       data-options="valueField:'ID',textField:'NAME',panelHeight:'auto'"/>
            </div>
            <div class="td col-2">发证机关：</div>
            <div class="td col-4">
                <input class="easyui-combobox" id="cmbVehicleIssueOrg" name="PLATE_TYPE"
                       data-options="valueField:'ID',textField:'NAME',panelHeight:'auto'"/>
            </div>
        </div>
        <div class=" row tr">
            <label class="td col-2">车辆品牌：</label>

            <div class="td col-4">
                <input class="inputlabel" name="VEHICLE_BRAND" type="text" readonly="true" />
            </div>
            <label class="td col-2">车身颜色：</label>

            <div class="td col-4">
                <input class="inputlabel" name="VEHICLE_COLOR" type="text" readonly="true" />
            </div>
        </div>
        <div class=" row tr">
            <label class="td col-2">使用性质：</label>
            <div class="td col-4">
                <input class="easyui-combobox" id="cmbVehicleCharacter" name="VEHICLE_CHARACTER"
                       data-options="valueField:'ID',textField:'NAME',panelHeight:'auto'"/>
            </div>
            <label class="td col-2">车辆类型：</label>

            <div class="td col-4">
                <input class="easyui-combobox" id="cmbVehicleType" name="VEHICLE_TYPE"
                       data-options="valueField:'ID',textField:'NAME',panelHeight:'auto'"/>
            </div>
        </div>
        <div class="row tr" style="display: none">
            <input name="VIOLATION_ID" type="text"/>
        </div>
        <div class=" row tr">
            <div class="td col-2">
                违法代码：
            </div>
            <div class="td col-4">
                <input class="inputlabel" type="text" name="VIOLATION_CODE"/>
            </div>
            <div class="td col-2">
                罚款金额：
            </div>
            <div class="td col-4">
                <input class="inputlabel" type="text" name="VIOLATION_CODE"/>
            </div>
        </div>
        <div class="row tr">

            <div class="td col-2">
                违法内容：
            </div>
            <div class="td col-6">
                <input class="inputlabel" type="text" name="VIOLATION_DESC"/>
                <!--<input class="easyui-combobox" id="cmbVioAction" name="VIOLATION_CODE"-->
                <!--data-options="valueField:'VIO_ACTION_CODE',textField:'VIO_SUMMARY',panelHeight:'auto'"  style="width: 200px"/>-->
            </div>
        </div>
    </div>
</div>
<!--违法信息-->
<div class="portlet col-6" style="float:right;">

    <div class="portlet-body">
        <div class="row tr">
            <div class="td col-2">
                违法道路：
            </div>
            <div class="td col-2">
                <input class="inputlabel" name="ROAD_CODE" type="text" readonly="true" style="width:100%" />
            </div>
            <div class="td col-3">
                路口/路段：
            </div>
            <div class="td col-2" cy-name="JUNCTION_CODE" >
                <input class="inputlabel" name="JUNCTION_CODE" type="text" options="formatter:CommonService.JunctionFormat" readonly="true" style="width:100%" />
            </div>
            <div class="td col-1">
                米数：
            </div>
            <div class="td col-2">
                <input class="inputlabel" name="MILEAGE" type="text" readonly="true" style="width: 30px"/>米
            </div>
        </div>
        <div class="row tr">
            <div class="td col-2">
                地点描述：
            </div>
            <div class="td col-10">
                <input class="inputlabel" type="text" name="ADDRESS_DESC"/>
            </div>
        </div>
        <div class="row tr">

            <div class="td col-2">
                违法时间：
            </div>
            <div class="td col-10">
                <input class="easyui-datebox" type="text" name="VIOLATION_TIME"/>
            </div>
        </div>



        <div class=" row tr">
            <div class="td col-2">
                采集机构：
            </div>
            <div class="td col-4">
                <input class="easyui-combobox" id="cmbOrg" name="ORG_CODE"
                       data-options="valueField:'ID',textField:'NAME',panelHeight:'auto'" style="width: 120px"/>
            </div>

            <div class="td col-2">
                采集设备：
            </div>
            <div class="td col-4">
                <input class="easyui-combobox" id="cmbDevice" name="DEVICE_NBR"
                       data-options="valueField:'ID',textField:'NAME',panelHeight:'auto'" style="width: 100%"/>
            </div>
        </div>

        <div class=" row tr">
            <div class="td col-2">
                车辆速度：
            </div>
            <div class="td col-2">
                <input class="inputlabel" name="SPEED" type="text" readonly="true" />
            </div>
            <div class="td col-2">
                (km/h)
            </div>
            <div class="td col-2">
                超速比例：
            </div>
            <div class="td col-2">
                <input class="inputlabel" name="OVER_SPEED_PERCENT" type="text" readonly="true" />
            </div>
            <div class="td col-2">
                (%)
            </div>
        </div>

        <div class=" row tr">
            <div class="td col-2">
                大车限速：
            </div>
            <div class="td col-2">
                <input class="inputlabel" name="LIMIT_LARGE" type="text" readonly="true" />
            </div>
            <div class="td col-2">
                (km/h)
            </div>

            <div class="td col-2">
                小车限速：
            </div>
            <div class="td col-2">
                <input class="inputlabel" name="LIMIT_SMALL" type="text" readonly="true" />
            </div>
            <div class="td col-2">
                (%)
            </div>
        </div>
    </div>
</div>
<!--下部按钮-->
<div class="row tr" style="margin-left: 20px;float:right;">
    <div class="portlet-body">
        <a href="#" class="easyui-linkbutton" style="width: 60px">录入</a>

        <a href="#" id="btnDiscard" class="easyui-menubutton button"
           data-options="iconCls:'icon-edit'" style="width: 80px">废弃</a>
        <div id="mbtnDiscard" style="width:150px;display:none">
            <div cy-click="DiscardAsync()">车速不足</div>
            <div cy-click="DiscardAsync()">无号牌</div>
            <div >查无车辆信息</div>
            <div>图片模糊</div>
            <div>遮挡号牌</div>
            <div class="menu-sep"></div>
            <div>套牌车</div>
            <div>假牌车</div>
            <div>军警车</div>
            <div>农用车</div>
        </div>

        <a href="#" class="easyui-linkbutton" cy-click="selectView('queryView')">显示列表</a>
        <a href="#" class="easyui-linkbutton" style="width: 60px">上一条</a>
        <a href="#" class="easyui-linkbutton" style="width: 60px">下一条</a>
    </div>
</div>
</form>
</div>
</div>


<script type="application/javascript">
    InitPage([],function($scope){
        $scope.plateTypeFormat = function (value, rowData, rowIndex) {
            return $scope.code2Name($scope.SysCodeDic.PlateType, value);
        };
        $scope.orgFormat= function (value, rowData, rowIndex) {
            return $scope.code2Name($scope.SysCodeDic.Org, value);
        };
        $scope.violationTypeFormat=function(value, rowData, rowIndex) {
            return $scope.code2Name($scope.SysCodeDic.ViolationType, value);
        };
        $scope.RoadFormat= function (value, rowData, rowIndex) {
            return $scope.code2Name($scope.SysCodeDic.Road, value);
        };
        $scope.gridDbClick= function (index, row) {
            $scope.selectView('detailView');
        };
        $scope.selectView= function (menuId) {
            $scope.$(".divView").css("display", "none");
            $scope.$("#" + menuId).css("display", "");
            var row = $scope.$('#tbVio').datagrid('getSelected');
            if(menuId=='detailView')
            {
                if (row) {
                    //$("#frmDetail").form("load",row);
                    //$scope.$setParam('frmDetail',row);
                    $scope.$updateDom('frmDetail');
                    $scope.$updateData(row);
                }
                else {
                    console.log("nodata");
                }
            }
        };

        $.extend($scope,{
            load : function(){

                $scope.$("#btnDiscard").menubutton({
                    menu : $scope.$("#mbtnDiscard")
                });
                //系统代码
                var dataRoot="data/violationMgr/sysCode.json";
                $.getJSON(dataRoot,function(data){
                    $scope.SysCodeDic=data;
                    $scope.InitPageSysCode();
                });
                //机构
                var dataRoot="data/violationMgr/org.json";
                $.getJSON(dataRoot,function(data){
                    $scope.SysCodeDic.Org=data;
                    $('#cmbOrg').combobox('loadData', $scope.SysCodeDic.Org);
                });
                //违法代码
                var dataRoot="data/violationMgr/vioAction.json";
                $.getJSON(dataRoot,function(data){
                    $scope.SysCodeDic.VioAction=data;
                    $('#cmbVioAction').combobox('loadData', $scope.SysCodeDic.VioAction);
                });
                //道路
                var dataRoot="data/violationMgr/road.json";
                $.getJSON(dataRoot,function(data){
                    $scope.SysCodeDic.Road=data;
                });

                $scope.selectView("queryView");
                console.log("loadSuccess!");
            },
            enter : function(){
                console.log("enter");
            },
            leave : function(){
                console.log("leave");
            },
            close : function(){
                console.log("close");
            },
            formData :  {
                username : "admin1231312",
                password : "123456",
                combo : 4,
                code : 1234
            },

            options : {
                columns : [[//注意，此处是二维数组
                    {field:'id',checkbox:true},
                    {title:"违法类型",field:"VIOLATION_TYPE",width:10,formatter:$scope.violationTypeFormat},
                    {title:"号牌号码",field:"PLATE_NBR",width:10},
                    {title:"号牌种类",field:"PLATE_TYPE",width:10,formatter:$scope.plateTypeFormat},
                    {title:"违法时间",field:"VIOLATION_TIME",width:10},
                    {title:"违法地点",field:"ADDRESS_DESC",width:10},
                    {title:"违法行为描述",field:"VIOLATION_DESC",width:10},
                    {title:"速度",field:"SPEED",width:10},
                    {title:"采集机构",field:"ORG_CODE",width:10,formatter:$scope.orgFormat}
                ]],
                singleSelect:true,
                method:'get',
                fitColumns:true,
                striped:true,
                selectOnCheck:false,
                onDblClickRow:$scope.gridDbClick,
                pagination:true
            },
            saveToLocal: function () {
                //todo
            },

            SearchAsync: function () {
                var dataRoot="data/violationMgr/violation.json";
                $scope.$search("formData");
            },
            SaveAsync: function () {
                //todo
            },
            //页面系统代码
            SysCodeDic: {
                PlateType:null,
                PlateColor:null,
                ViolationType:null,
                EnforcementCategory:null,
                Org: null,
                Road: null,
                Device: null,
                User:null,
                VioAction:null,
                District:null,
                VehicleType:null,
                VehicleCharacter:null,
                VehicleIssueOrg:null
            },
            InitPageSysCode: function () {
                $('#cmbPlateTypeQ').combobox('loadData',$scope.SysCodeDic.PlateType);
                $('#cmbViolationTypeQ').combobox('loadData', $scope.SysCodeDic.ViolationType);
                $('#cmbEnforcementCategoryQ').combobox('loadData', $scope.SysCodeDic.EnforcementCategory);
                $('#cmbDistrict').combobox('loadData', $scope.SysCodeDic.District);
                $('#cmbVehicleIssueOrg').combobox('loadData', $scope.SysCodeDic.VehicleIssueOrg);
                $('#cmbVehicleType').combobox('loadData', $scope.SysCodeDic.VehicleType);
                $('#cmbVehicleCharacter').combobox('loadData', $scope.SysCodeDic.VehicleCharacter);
                //详细

//                $('#cmbPlateType').combobox('loadData', $scope.SysCodeDic.Org);
//                $('#cmbViolationType').combobox('loadData', $scope.SysCodeDic.Org);
//                $('#cmbPlateColor').combobox('loadData', $scope.SysCodeDic.Org);
//                $('#cmbCollectionType').combobox('loadData', $scope.SysCodeDic.Org);
//                $('#cmbDevice').combobox('loadData', $scope.SysCodeDic.Org);
//                $('#cmbRoadJunction').combobox('loadData', $scope.SysCodeDic.Org);
//                $('#cmbRoad').combobox('loadData', $scope.SysCodeDic.Org);

            },
            //将grid列表中的代码转换为名字显示
            code2Name: function (codes, value) {
                if (codes == null) return value + '无法转换';
                //var codes = speedTidy.sysCodeDic[codeType];
                for (var i = 0; i < codes.length; i++) {
                    if (codes[i].ID == value) {
                        return codes[i].NAME;
                        break;
                    }
                }
            },
            DiscardAsync:function(discardType){
                alert("Discard,type"+discardType);
            }
        });
    });

</script>

<link rel="stylesheet" href="views/Violation/assets/css/gridCell.css"/>
<link rel="stylesheet" href="views/Violation/assets/css/portlet.css"/>
<link rel="stylesheet" href="views/Violation/assets/css/form.css"/>