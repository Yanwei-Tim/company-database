<div id="vioprocessstatsdiv" class="easyui-layout" data-options="fit:true"><div data-options="region:'north'" style="height:150px"><div class="toolbar" style="float:left;width:100%"><form class="searchForm" method="post"><div class="searchPanel"><div class="panel_title">查询条件</div><div class="table"><div class="tr"><div class="th" style="padding-left:5px">统计方式：</div><div class="td"><select class="easyui-combobox" style="width:150px" name="StatMode" data-options="singleSelect:true,panelHeight:'auto'"><option value="1">执行机构</option><option value="2">录入人员</option><option value="3">违法类型</option><option value="4">执法类型</option><option value="5">设备类型</option></select></div><div class="th">处理机构：</div><div class="td"><select id="orgLevel" class="easyui-combotree" name="OrgCode" data-options="" onselect="" style="width:150px"></div><div class="th">违法时间：</div><div class="td"><input class="easyui-datetimebox" name="VioStart" style="width:150px" data-options="required:true,showSeconds:true"></div><div class="th">至：</div><div class="td"><input class="easyui-datetimebox" name="VioEnd" style="width:150px" data-options="required:true,showSeconds:true"></div></div><div class="tr"><div class="th" style="padding-left:5px">采集类型：</div><div class="td"><select class="easyui-combobox" style="width:150px" name="CollectedType" data-options="multiple:true,panelHeight:'auto'"><option value="1">闯红灯设备</option><option value="2">公路卡口设备</option><option value="3">测速设备</option><option value="4">闭路电视</option><option value="5">移动摄像</option><option value="6">警务通</option><option value="7">区间测速</option><option value="8">卫星定位装置</option><option value="9">其它电子设备</option></select></div><div class="th">违法类型：</div><div class="td"><input class="easyui-combobox" id="violationType" name="ViolationType" style="width:150px" data-options="valueField:'ID',textField:'NAME',multiple:true,panelHeight:'auto'"></div><div class="th">录入时间：</div><div class="td"><input class="easyui-datetimebox" name="EntryStart" style="width:150px" data-options="required:false,showSeconds:true"></div><div class="th">至：</div><div class="td"><input class="easyui-datetimebox" name="EntryEnd" style="width:150px" data-options="required:false,showSeconds:true"></div></div></div></div><div class="linkbutton_toolbar"><a href="#" class="easyui-linkbutton button-search" data-options="iconCls:'icon-search'" onclick="VioStatsMgr.StatsViolaitonInfos()">统计</a></div></form></div></div><div data-options="region:'center'"><table id="dg" class="easyui-datagrid" data-options="
              height:300,
               fitColumns:true,
               striped:true,
               noHeader:true,
               rownumbers:true,
               pagination:true,
               showfooter:true,
               singleSelect:true,
               scrollbarSize:0,
               toolbar:'#vioProcessStatsDiv .toolbar'
               "><thead><tr><th data-options="field:'ORG_NAME',width:10">处理机构</th><th data-options="field:'VIO_TYPE',width:10">已分拣</th><th data-options="field:'VIO_NUM',width:10" formatter="formatPrice">正常执法</th><th data-options="field:'field3',width:10,align:'right'">军车</th><th data-options="field:'field4',width:10,align:'right'">警车</th><th data-options="field:'field5',width:10,align:'right'">农用车</th><th data-options="field:'field6',width:10,align:'right'">白名单车</th><th data-options="field:'field7',width:10,align:'right'">废弃</th></tr></thead></table></div><div data-options="region:'south'" style="height:400px"><div id="container" title=""></div></div></div><script>function compare(t){return function(e,a){var o=e[t],n=a[t];return o>n?-1:n>o?1:0}}function formatPrice(t,e){return t>3?'<span style="color:red;">'+t+"</span>":t}function convert(t){function e(t,e){for(var a=0;a<t.length;a++)if(t[a].ID==e)return!0;return!1}for(var a=[],o=0;o<t.length;o++){var n=t[o];e(t,n.RESERVE1)||a.push({id:n.ID,text:n.NAME})}for(var r=[],o=0;o<a.length;o++)r.push(a[o]);for(;r.length;)for(var i=r.shift(),o=0;o<t.length;o++){var n=t[o];if(n.RESERVE1==i.id){var s={id:n.ID,text:n.NAME};i.children?i.children.push(s):i.children=[s],r.push(s)}}return a}$.parser.onComplete=function(){$.ajax({url:"/ITS3Web.Service.Violation.ViolationAnalysisService/InitPageSysCode",type:"POST",data:{},beforeSend:function(t){t.setRequestHeader("ContextID",ContextId)},contentType:"application/json",success:function(t){VioStatsMgr.sysCodeDic=t,VioStatsMgr.initCombobox(t)},error:function(t){alert(t.responseText)}},$("#orgLevel").combotree({loadFilter:function(t){return convert(t)}})),$.parser.onComplete=function(){}};var VioStatsMgr={defaultParams:{},sysCodeDic:null,search:function(){$.ajax({url:"/ITS3Web.Service.Violation.ViolationAnalysisService/InitPageSysCode",type:"POST",data:{},beforeSend:function(t){t.setRequestHeader("ContextID",ContextId)},contentType:"application/json",success:function(t){VioStatsMgr.sysCodeDic=t,VioStatsMgr.initCombobox(t)},error:function(t){alert(t.responseText)}})},frmSubmit:function(t){return t.ContextId=ContextId,!0},initCombobox:function(t){$("#violationType").combobox("loadData",t.VIOLATIONTYPE),$("#orgLevel").combotree("loadData",t.ORGLEVEL)},StatsViolaitonInfos:function(){$("#vioprocessstatsdiv .searchForm").form("submit",{url:"/ITS3Web.Service.Violation.ViolationAnalysisService/StatsViolaitonInfos",onSubmit:function(t){return t.ContextId=parent.ContextId,!0},success:function(data){var data=eval("("+data+")");if(""!=data.Error)alert(data.Error);else{0==data.Result.length&&alert("没有查询出符合条件的违法处理记录！");var gridData={};gridData.total=data.Result.length,gridData.rows=data.Result,$("#dg").datagrid("loadData",gridData),VioStatsMgr.plotChart(data.Result)}$.messager.progress("close")}})},plotChart:function(data){data.sort(compare("VIO_TYPE"));for(var obj="[",_sersies=new Array,_categories=new Array,i=0;i<data.length;i++)_categories.push(data[i].ORG_NAME),0==_sersies.length?(_sersies.push(data[i].VIO_TYPE),obj+="{name:'"+data[i].VIO_TYPE+"',data:[['"+data[i].ORG_NAME+"',"+data[i].VIO_NUM+"]"):"-1"==_sersies[_sersies.length-1].indexOf(data[i].VIO_TYPE)?(_sersies.push(data[i].VIO_TYPE),obj+="]},{name:'"+data[i].VIO_TYPE+"',data:[['"+data[i].ORG_NAME+"',"+data[i].VIO_NUM+"]"):obj+=",['"+data[i].ORG_NAME+"',"+data[i].VIO_NUM+"]";obj+="]}]",$("#container").highcharts({chart:{type:"column"},title:{text:"Monthly Average Rainfall"},subtitle:{text:"Source: WorldClimate.com"},plotOptions:{column:{pointPadding:.2,borderWidth:0}},xAxis:{categories:[]},yAxis:{min:0,title:{text:"采 集 违 法 (次)"}},legend:{enabled:!0},series:eval(obj),lang:{printChart:"打印图表",contextButtonTitle:"图表导出菜单",decimalPoint:".",downloadJPEG:"下载JPEG图片",downloadPDF:"下载PDF文件",downloadPNG:"下载PNG文件",downloadSVG:"下载SVG文件",drillUpText:"返回 {series.name}",loading:"加载中"}})}};</script>