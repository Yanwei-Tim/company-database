<div id="vioCollectedDiv" class="easyui-layout" data-options="fit:true"><div data-options="region:'north'" style="height:150px"><div class="toolbar" style="float:left;width:100%"><form class="searchForm" method="post"><div class="searchPanel"><div class="panel_title">查询条件</div><div class="table"><div class="tr"><div class="th" style="padding-left:5px">统计方式：</div><div class="td"><select name="StatMode" class="easyui-combobox" panelheight="auto" style="width:150px"><option value="0" selected="selected">采集机关</option><option value="1">采集民警</option><option value="2">采集类型</option><option value="3">采集设备</option></select></div><div class="th" style="padding-left:5px">采集机关：</div><div class="td"><select id="org" class="easyui-combotree" data-options="" name="OrgCode" style="width:150px"></select></div><div class="th" style="padding-left:5px">违法时间：</div><div class="td"><input class="easyui-datetimebox" name="VioStart" style="width:150px"></div><div class="th" style="padding-left:5px">至：</div><div class="td"><input class="easyui-datetimebox" name="VioEnd" style="width:150px"></div></div><div class="tr"><div class="th" style="padding-left:5px">采集类型：</div><div class="td"><select class="easyui-combobox" style="width:150px" name="CollectedType" data-options="multiple:true,panelHeight:'auto'"><option value="">--请选择--</option><option value="1">闯红灯设备</option><option value="2">公路卡口设备</option><option value="3">测速设备</option><option value="4">闭路电视</option><option value="5">移动摄像</option><option value="6">警务通</option><option value="7">区间测速</option><option value="8">卫星定位装置</option><option value="9">其它电子设备</option></select></div></div></div></div><div class="linkbutton_toolbar"><a href="#" class="easyui-linkbutton button-search" data-options="iconCls:'icon-search'" onclick="VioCollectMgr.StatsCollectInfos()">统计</a> <a href="#" class="easyui-linkbutton button-search" data-options="iconCls:'icon-search'" onclick="$(&quot;#dgv&quot;).pivotgrid(&quot;layout&quot;)">布局</a></div></form></div></div><div data-options="region:'center'"><table id="dgv" class="easyui-datagrid" data-options="
               fit:true,
               fitColumns:true,
               striped:true,
               noHeader:true,
               rownumbers:true,
               pagination:true,
               showfooter:true,
               singleSelect:true,
               scrollbarSize:0
               "></table></div><div data-options="region:'south'" style="height:400px"><div id="container" title=""></div></div></div><script>function compare(t){return function(e,o){var a=e[t],i=o[t];return a>i?-1:i>a?1:0}}function formatPrice(t,e){return t>3?'<span style="color:red;">'+t+"</span>":t}function convert(t){function e(t,e){for(var o=0;o<t.length;o++)if(t[o].ID==e)return!0;return!1}for(var o=[],a=0;a<t.length;a++){var i=t[a];e(t,i.RESERVE1)||o.push({id:i.ID,text:i.NAME})}for(var r=[],a=0;a<o.length;a++)r.push(o[a]);for(;r.length;)for(var n=r.shift(),a=0;a<t.length;a++){var i=t[a];if(i.RESERVE1==n.id){var s={id:i.ID,text:i.NAME};n.children?n.children.push(s):n.children=[s],r.push(s)}}return o}$.parser.onComplete=function(){$.ajax({url:"/ITS3Web.Service.Violation.ViolationAnalysisService/InitPageSysCode",type:"POST",data:{},beforeSend:function(t){t.setRequestHeader("ContextID",ContextId)},contentType:"application/json",success:function(t){VioCollectMgr.sysCodeDic=t,VioCollectMgr.initCombobox(t)},error:function(t){alert(t.responseText)}},$("#vioCollectedDiv #org").combotree({loadFilter:function(t){return convert(t)}})),$.parser.onComplete=function(){}};var VioCollectMgr={defaultParams:{},sysCodeDic:null,search:function(){$.ajax({url:"/ITS3Web.Service.Violation.ViolationAnalysisService/InitPageSysCode",type:"POST",data:{},beforeSend:function(t){t.setRequestHeader("ContextID",ContextId)},contentType:"application/json",success:function(t){VioCollectMgr.sysCodeDic=t,VioCollectMgr.initCombobox(t)},error:function(t){alert(t.responseText)}})},frmSubmit:function(t){return t.ContextId=ContextId,!0},initCombobox:function(t){$("#vioCollectedDiv #org").combotree("loadData",t.T_DIC_ORGLEVEL)},StatsCollectInfos:function(){$("#vioCollectedDiv .searchForm").form("submit",{url:"/ITS3Web.Service.Violation.ViolationAnalysisService/StatsCollectInfos",onSubmit:function(t){return t.ContextId=parent.ContextId,!0},success:function(data){var data=eval("("+data+")");if(""!=data.Error)alert(data.Error);else{0==data.Result.length&&alert("没有查询出符合条件的违法采集记录！");var gridData={};gridData.total=data.Result.length,gridData.rows=data.Result,$("#vioCollectedDiv #dgv").pivotgrid({data:data.Result,method:"get",pivot:{rows:["ORG_NAME"],columns:["VIO_TYPE"],values:[{field:"VIO_NUM",op:"sum"}]},valuePrecision:0,valueStyler:function(t,e,o){return/VIO_NUM$/.test(this.field)&&t>3&&5>t?"background:#D8FFD8":void 0}}),VioCollectMgr.plotBarChart(data.Result)}$.messager.progress("close")}})},plotBarChart:function(data){data.sort(compare("VIO_TYPE"));for(var obj="[",_sersies=new Array,_categories=new Array,i=0;i<data.length;i++)_categories.push(data[i].ORG_NAME),0==_sersies.length?(_sersies.push(data[i].VIO_TYPE),obj+="{name:'"+data[i].VIO_TYPE+"',data:[['"+data[i].ORG_NAME+"',"+data[i].VIO_NUM+"]"):"-1"==_sersies[_sersies.length-1].indexOf(data[i].VIO_TYPE)?(_sersies.push(data[i].VIO_TYPE),obj+="]},{name:'"+data[i].VIO_TYPE+"',data:[['"+data[i].ORG_NAME+"',"+data[i].VIO_NUM+"]"):obj+=",['"+data[i].ORG_NAME+"',"+data[i].VIO_NUM+"]";obj+="]}]",$("#vioCollectedDiv #container").highcharts({chart:{type:"column"},title:{text:"各机构采集违法数据对比图"},plotOptions:{column:{pointPadding:.2,borderWidth:0}},xAxis:{categories:[]},yAxis:{min:0,title:{text:"采 集 违 法 (次)"}},legend:{enabled:!0},series:eval(obj)})}};</script>