<div data-options="region:'north'"><div id="stdiv" class="easyui-tabs" style="height:auto"><div id="orgDiv" title="按机构采集违法趋势" style="padding:10px"><div data-options="region:'north'" style="height:100px"><div class="toolbar" style="float:left;width:100%"><form class="searchForm" method="post"><div class="searchPanel"><div class="panel_title">查询条件</div><div class="table"><div class="tr"><div class="th" style="padding-left:5px">采集机关：</div><div class="td"><select id="orgLevel" class="easyui-combotree" name="OrgCode" data-options="" onselect="" style="width:150px"></div><div class="th" style="padding-left:5px">违法类型：</div><div class="td"><input class="easyui-combobox" id="violationType" name="ViolationType" style="width:150px" data-options="valueField:'ID',textField:'NAME',multiple:true,panelHeight:'auto'"></div><div class="th" style="padding-left:5px">违法时间：</div><div class="td"><input class="easyui-datebox" style="width:150px" data-options="required:true"></div><div class="th" style="padding-left:5px">至：</div><div class="td"><input class="easyui-datebox" style="width:150px" data-options="required:true"></div><div class="td"><input type="hidden" name="StatMode"></div></div></div></div><div class="linkbutton_toolbar"><a href="#" class="easyui-linkbutton button-search" data-options="iconCls:'icon-search'" onclick="VioTrendMgr.StatsVioTrendInfos()">统计</a></div></form></div></div></div><div id="roadDiv" title="按道路采集违法趋势" style="padding:10px"><div data-options="region:'north'" style="height:150px"><div class="toolbar" style="float:left;width:100%"><form class="searchForm" method="post"><div class="searchPanel"><div class="panel_title">查询条件</div><div class="table"><div class="tr"><div class="th" style="padding-left:5px">行政区划：</div><div class="td"><input id="districtCode" class="easyui-combobox" data-options="valueField:'ID',textField:'NAME'" style="width:150px"></div><div class="th" style="padding-left:5px">道路类型：</div><div class="td"><input id="roadType" class="easyui-combobox" data-options="valueField:'ID',textField:'NAME',multiple:true" style="width:150px"></div><div class="th" style="padding-left:5px">道路名称：</div><div class="td"><input id="roadCode" class="easyui-combobox" data-options="valueField:'ID',textField:'NAME',multiple:true" style="width:150px"></div><div class="th" style="padding-left:5px">违法类型：</div><div class="td"><input class="easyui-combobox" id="violationType" name="VIOLATION_TYPE" style="width:150px" data-options="valueField:'ID',textField:'NAME',multiple:true,panelHeight:'auto'"></div></div><div class="tr"><div class="th" style="padding-left:5px">违法时间：</div><div class="td"><input class="easyui-datebox" style="width:150px"></div><div class="th" style="padding-left:5px"></div><div class="th" style="width:60px">至：</div><div class="td"><input class="easyui-datebox" style="width:150px"></div></div></div></div><div class="linkbutton_toolbar"><a href="#" class="easyui-linkbutton button-search" data-options="iconCls:'icon-search'" onclick="VioTrendMgr.StatsVioTrendInfos()">统计</a></div></form></div></div></div><div id="siteDiv" title="按点位采集违法趋势" style="padding:10px"><div data-options="region:'north'" style="height:150px"><div class="toolbar" style="float:left;width:100%"><form class="searchForm" method="post"><div class="searchPanel"><div class="panel_title">查询条件</div><div class="table"><div class="tr"><div class="th" style="padding-left:5px">行政区划：</div><div class="td"><input id="districtCode" class="easyui-combobox" data-options="valueField:'ID',textField:'NAME'" style="width:150px"></div><div class="th" style="padding-left:5px">道路名称：</div><div class="td"><input id="roadCode" class="easyui-combobox" data-options="valueField:'ID',textField:'NAME',multiple:true,panelHeight:'auto'" style="width:150px"></div><div class="th" style="padding-left:5px">采集点位：</div><div class="td"><input class="easyui-combobox" id="siteCode" data-options="valueField:'ID',textField:'NAME',multiple:true,panelHeight:'auto'" style="width:150px"></div><div class="th" style="padding-left:5px">违法类型：</div><div class="td"><input class="easyui-combobox" id="violationType" name="VIOLATION_TYPE" style="width:150px" data-options="valueField:'ID',textField:'NAME',multiple:true,panelHeight:'auto'"></div></div><div class="tr"><div class="th" style="padding-left:5px">违法时间：</div><div class="td"><input class="easyui-datebox" style="width:150px"></div><div class="th" style="padding-left:5px"></div><div class="th" style="width:60px">至：</div><div class="td"><input class="easyui-datebox" style="width:150px"></div></div><div></div></div></div><div class="linkbutton_toolbar"><a href="#" class="easyui-linkbutton button-search" data-options="iconCls:'icon-search'" onclick="VioTrendMgr.StatsVioTrendInfos()">统计</a></div></form></div></div></div></div></div><div data-options="region:'center'"><table id="dgv_trend" class="easyui-datagrid" style="height:auto" title="" data-options="fitColumns:true,noHeader:true,rownumbers:true,pagination:true,showFooter:true, singleSelect:true"></table></div><div id="chart" data-options="region:'south'" style="height:400px"><div id="container" title=""></div></div><script>function compare(e){return function(t,a){var o=t[e],r=a[e];return o>r?-1:r>o?1:0}}function formatPrice(e,t){return e>3?'<span style="color:red;">'+e+"</span>":e}function convert(e){function t(e,t){for(var a=0;a<e.length;a++)if(e[a].ID==t)return!0;return!1}for(var a=[],o=0;o<e.length;o++){var r=e[o];t(e,r.RESERVE1)||a.push({id:r.ID,text:r.NAME})}for(var i=[],o=0;o<a.length;o++)i.push(a[o]);for(;i.length;)for(var n=i.shift(),o=0;o<e.length;o++){var r=e[o];if(r.RESERVE1==n.id){var s={id:r.ID,text:r.NAME};n.children?n.children.push(s):n.children=[s],i.push(s)}}return a}$.parser.onComplete=function(){$.ajax({url:"/ITS3Web.Service.Violation.ViolationAnalysisService/InitPageSysCode",type:"POST",data:{},beforeSend:function(e){e.setRequestHeader("ContextID",ContextId)},contentType:"application/json",success:function(e){VioTrendMgr.sysCodeDic=e,VioTrendMgr.initCombobox(e)},error:function(e){alert(e.responseText)}},$(".easyui-combotree").combotree({loadFilter:function(e){return convert(e)}})),$.parser.onComplete=function(){}};var VioTrendMgr={defaultParams:{},sysCodeDic:null,search:function(){$.ajax({url:"/ITS3Web.Service.Violation.ViolationAnalysisService/InitPageSysCode",type:"POST",data:{},beforeSend:function(e){e.setRequestHeader("ContextID",ContextId)},contentType:"application/json",success:function(e){VioTrendMgr.sysCodeDic=e,VioTrendMgr.initCombobox(e)},error:function(e){alert(e.responseText)}})},frmSubmit:function(e){return e.ContextId=ContextId,!0},initCombobox:function(e){$("#stdiv #violationType").combobox("loadData",e.T_DIC_VIOTYPE),$("#stdiv #orgLevel").combotree("loadData",e.T_DIC_ORGLEVEL),$("#stdiv #roadCode").combobox("loadData",e.T_DIC_ROAD_INFO),$("#stdiv #siteCode").combobox("loadData",e.T_DIC_ROAD_SITE),$("#stdiv #districtCode").combobox("loadData",e.T_DIC_DISTRIC),$("#stdiv #roadType").combobox("loadData",e.T_DIC_ROAD_TYPE)},StatsVioTrendInfos:function(){$("#orgDiv .searchForm").form("submit",{url:"/ITS3Web.Service.Violation.ViolationAnalysisService/StatsVioTrendInfos",onSubmit:function(e){e.ContextId=parent.ContextId;var t=$("#stdiv").tabs("getSelected");if(t){var a=$("#stdiv").tabs("getTabIndex",t);e.StatMode=a+1}return!0},success:function(data){var data=eval("("+data+")");if(""!=data.Error)alert(data.Error);else{0==data.Result.length&&alert("没有查询出符合条件的违法趋势记录！");var gridData={};gridData.total=data.Result.length,gridData.rows=data.Result,$("#dgv_trend").pivotgrid({data:data.Result,pivot:{rows:["机构名称"],columns:["违法时间"],values:[{field:"违法数",op:"sum"}]},valuePrecision:0,valueStyler:function(e,t,a){return/违法数$/.test(this.field)&&e>3&&5>e?"background:#D8FFD8":void 0}}),VioTrendMgr.plotBarChart(data.Result)}$.messager.progress("close")}})},plotBarChart:function(data){data.sort(compare("机构编码"));for(var obj="[",_sersies=new Array,_categories=new Array,i=0;i<data.length;i++)_categories.push(new Date(data[i].违法日期).getTime()),0==_sersies.length?(_sersies.push(data[i].机构名称),obj+="{name:'"+data[i].机构名称+"',data:[["+new Date(data[i].违法日期).getTime()+","+data[i].违法数+"]"):"-1"==_sersies[_sersies.length-1].indexOf(data[i].机构名称)?(_sersies.push(data[i].机构名称),obj+="]},{name:'"+data[i].机构名称+"',data:[["+new Date(data[i].违法日期).getTime()+","+data[i].违法数+"]"):obj+=",["+new Date(data[i].违法日期).getTime()+","+data[i].违法数+"]";obj+="]}]",$("#chart #container").highcharts({chart:{type:"line"},title:{text:"各机构采集违法数据趋势图"},plotOptions:{column:{pointPadding:.2,borderWidth:0},pointInterval:864e5},xAxis:{type:"datetime",dateTimeLabelFormats:{second:"%Y-%b-%e %H:%M:%S.%L"},step:1,dateTimeLabelFormats:{day:"%b月%e日",second:"%H:%M:%S",minute:"%H:%M",hour:"%H:%M",week:"%e. %b",month:"%y '%b",year:"%Y"}},yAxis:{min:0,title:{text:"整 理 违 法 (次)"}},legend:{enabled:!0},series:eval(obj)})}};</script>