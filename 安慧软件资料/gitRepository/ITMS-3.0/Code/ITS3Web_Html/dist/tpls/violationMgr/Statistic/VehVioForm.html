<div id="vioFormDiv" class="easyui-layout" data-options="fit:true"><div data-options="region:'north'" style="height:150px"><div class="toolbar" style="float:left;width:100%"><form class="searchForm" method="post"><div class="searchPanel"><div class="panel_title">查询条件</div><div class="table"><div class="tr"><div class="th" style="padding-left:5px">采集机构：</div><div class="td"><select id="orgLevel" class="easyui-combotree" name="OrgCode" data-options="" onselect="" style="width:150px"></div><div class="th" style="padding-left:5px">道路名称：</div><div class="td"><input class="easyui-combobox" id="roadCode" name="RoadID" data-options="valueField:'ID',textField:'NAME',multiple:true" style="width:150px"></div><div class="th" style="padding-left:5px">采集点位：</div><div class="td" style="padding-left:5px"><input class="easyui-combobox" id="siteCode" name="SiteCode" data-options="valueField:'ID',textField:'NAME',multiple:true" style="width:150px"></div><div class="th" style="padding-left:5px">违法类型：</div><div class="td"><input class="easyui-combobox" id="violationType" name="ViolationType" style="width:150px" data-options="valueField:'ID',textField:'NAME',multiple:true"></div></div><div class="tr"><div class="th" style="padding-left:5px">违法时间：</div><div class="td"><input class="easyui-datebox" style="width:150px" name="VioStart" data-options="required:true,showSeconds:true"></div><div class="th" style="padding-left:5px"></div><div class="th" style="width:60px">至：</div><div class="td"><input class="easyui-datebox" style="width:150px" name="VioEnd" data-options="required:true,showSeconds:true"></div></div></div></div><div class="linkbutton_toolbar"><a href="#" class="easyui-linkbutton button-search" data-options="iconCls:'icon-search'" onclick="VioFormMgr.StatsVioFormDetailInfos()">统计</a> <a href="#" class="easyui-linkbutton button-search" data-options="iconCls:'icon-search'" onclick="$(&quot;#vioFormDiv #dgv&quot;).pivotgrid(&quot;layout&quot;)">布局</a></div></form></div></div><div data-options="region:'center'"><table id="dgv" class="easyui-datagrid" data-options="
               fit:true,
               fitColumns:true,
               striped:true,
               noHeader:true,
               rownumbers:true,
               pagination:true,
               showfooter:true,
               singleSelect:true,
               scrollbarSize:0
               "></table></div><div data-options="region:'south'" style="height:400px"><div id="container" title=""></div></div></div><script>function formatProgress(t){if(t){var e='<div style="width:100%;"><div style="width:'+t/100+'%;background:pink;color:black">'+t/100+"%</div>";return e}return""}function convert(t){function e(t,e){for(var o=0;o<t.length;o++)if(t[o].ID==e)return!0;return!1}for(var o=[],a=0;a<t.length;a++){var r=t[a];e(t,r.RESERVE1)||o.push({id:r.ID,text:r.NAME})}for(var i=[],a=0;a<o.length;a++)i.push(o[a]);for(;i.length;)for(var n=i.shift(),a=0;a<t.length;a++){var r=t[a];if(r.RESERVE1==n.id){var s={id:r.ID,text:r.NAME};n.children?n.children.push(s):n.children=[s],i.push(s)}}return o}$.parser.onComplete=function(){$.ajax({url:"/ITS3Web.Service.Violation.ViolationAnalysisService/InitPageSysCode",type:"POST",data:{},beforeSend:function(t){t.setRequestHeader("ContextID",ContextId)},contentType:"application/json",success:function(t){VioFormMgr.sysCodeDic=t,VioFormMgr.initCombobox(t)},error:function(t){alert(t.responseText)}},$("#vioFormDiv #orgLevel").combotree({loadFilter:function(t){return convert(t)}})),$.parser.onComplete=function(){}};var VioFormMgr={defaultParams:{},sysCodeDic:null,search:function(){$.ajax({url:"/ITS3Web.Service.Violation.ViolationAnalysisService/InitPageSysCode",type:"POST",data:{},beforeSend:function(t){t.setRequestHeader("ContextID",ContextId)},contentType:"application/json",success:function(t){VioFormMgr.sysCodeDic=t,VioFormMgr.initCombobox(t)},error:function(t){alert(t.responseText)}})},frmSubmit:function(t){return t.ContextId=ContextId,!0},initCombobox:function(t){$("#vioFormDiv #violationType").combobox("loadData",t.T_DIC_VIOTYPE),$("#vioFormDiv #orgLevel").combotree("loadData",t.T_DIC_SYS_ORG),$("#vioFormDiv #roadCode").combobox("loadData",t.T_DIC_ROAD_INFO),$("#vioFormDiv #siteCode").combobox("loadData",t.T_DIC_ROAD_SITE)},StatsVioFormDetailInfos:function(){$("#vioFormDiv .searchForm").form("submit",{url:"/ITS3Web.Service.Violation.ViolationAnalysisService/StatsVioFormDetailInfos",onSubmit:function(t){return t.ContextId=parent.ContextId,!0},success:function(data){var data=eval("("+data+")");if(""!=data.Error)alert(data.Error);else{0==data.Result.length&&alert("没有查询出符合条件的违法采集记录！");var gridData={};gridData.total=data.Result.length,gridData.rows=data.Result,$("#vioFormDiv #dgv").pivotgrid({data:data.Result,method:"get",pivot:{rows:["ROAD_NAME","SITE_NAME"],columns:["VIOTYPE_NAME","VIOLATION_CODE"],values:[{field:"数量",op:"sum"},{field:"比率",formatter:formatProgress,op:"sum"}]},valueStyler:function(t,e,o){return/数量$/.test(this.field)&&t>3&&5>t?"background:#D8FFD8":void 0}}),VioFormMgr.plotBarChart(data.Result)}$.messager.progress("close")}})},plotBarChart:function(data){var value=$("#roadCode option:selected").text(),obj="";if(""==value){data.sort(compare("ROAD_CODE"));for(var _sersies=new Array,_categories=new Array,i=0;i<data.length;i++)_categories.push(data[i].ROAD_NAME),0==_sersies.length?(_sersies.push(data[i].ROAD_NAME),obj+="{name:'"+data[i].VIOTYPE_NAME+"',data:[['"+data[i].ROAD_NAME+"',"+data[i].数量+"]"):"-1"==_sersies[_sersies.length-1].indexOf(data[i].VIO_TYPE)?(_sersies.push(data[i].ROAD_NAME),obj+="]},{name:'"+data[i].VIOTYPE_NAME+"',data:[['"+data[i].ROAD_NAME+"',"+data[i].数量+"]"):obj+=",['"+data[i].ROAD_NAME+"',"+data[i].数量+"]";obj="["+obj+"]}]",alert(obj)}$("#vioFormDiv #container").highcharts({chart:{type:"column"},title:{text:"违法行为构成分析"},plotOptions:{column:{pointPadding:.2,borderWidth:0}},xAxis:{categories:[]},yAxis:{min:0,title:{text:"采 集 违 法 (次)"}},legend:{enabled:!0},series:eval(obj)})}};</script>