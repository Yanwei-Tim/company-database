<div id="cc" class="easyui-layout" style="width:600px;height:400px"><div data-options="region:'west', title:'图层列表', split:true,border:true" style="width:200px"><br><label><input name="layer1" type="checkbox" value="" cy-change="selectAll">全选</label><br><br><label><input name="layer" type="checkbox" value="11" cy-change="addLayer">路口</label><img align="bottom" src="frameworks/easyui/themes/icons/man1.png"><br><br><label><input name="layer" type="checkbox" value="12" cy-change="addLayer">匝道</label><img align="bottom" src="frameworks/easyui/themes/icons/man1.png"><br><br><label><input name="layer" type="checkbox" value="13" cy-change="addLayer">高速出入口</label><img align="bottom" src="frameworks/easyui/themes/icons/man1.png"><br><br><label><input name="layer" type="checkbox" value="14" cy-change="addLayer">互通立交枢纽</label><img align="bottom" src="frameworks/easyui/themes/icons/man1.png"><br><br><label><input name="layer" type="checkbox" value="15" cy-change="addLayer">服务区</label><img align="bottom" src="frameworks/easyui/themes/icons/man1.png"><br><br><label><input name="layer" type="checkbox" value="16" cy-change="addLayer">收费站</label><img align="bottom" src="frameworks/easyui/themes/icons/man1.png"><br><br><label><input name="layer" type="checkbox" value="17" cy-change="addLayer">加油站</label><img align="bottom" src="frameworks/easyui/themes/icons/man1.png"><br><br><label><input name="layer" type="checkbox" value="18" cy-change="addLayer">停车场</label><img align="bottom" src="frameworks/easyui/themes/icons/man1.png"><br><br></div><div data-options="region:'center'"><div class="table" style="width:780px;height:35px;position:absolute;right:10px;top:0;z-index:100000;background:#0052A3"><div class="tr"><div class="th" style="color:#fff">目标图层：</div><div class="td" style="width:210px"><select class="easyui-combobox" id="tagLayer" data-options="valueField: 'value',textField: 'label'" name="TagLayer" style="width:200px"></select></div><div class="td"><a href="#" class="easyui-linkbutton button-add" iconcls="icon-add" plain="true" group="toolbar" cy-click="addFeature">添加</a></div><div class="td"><a href="#" class="easyui-linkbutton button-edit" iconcls="icon-edit" plain="true" group="toolbar" cy-click="modifyFeature">修改</a></div><div class="td"><a href="#" class="easyui-linkbutton button-remove" iconcls="icon-remove" plain="true" group="toolbar" cy-click="deleteFeature">删除</a></div><div class="td"><input class="easyui-textbox" id="txtRoleName" style="width:180px" data-options="prompt:'请输入查询内容'"> <a href="#" class="easyui-linkbutton button-search" iconcls="icon-search" plain="true" cy-click="searchFeature">查找</a></div></div></div><div style="width:100%;height:100%" id="map"></div></div></div><script type="text/javascript">InitPage([],function(e){var a,t,r,o,n,l,i,u,s,c,p,f,d,h=new CYMap(e.$("#map")[0]),y=new OpenLayers.Format.WKT;e.$("#tagLayer").combobox({onChange:function(e){e?(c=f[e].layer,p=f[e].shpType):(c=null,p=null)}}),e.load=function(){e.initData(),f={11:{label:"路口",layer:t,shpType:"point",value:"11",url:"data/trafficMonitor/roadGridMgr/lukou.json",height:200,width:530,href:"tpls/trafficMonitor/roadGridMgr/insertData/lukou.html"},12:{label:"匝道",layer:r,shpType:"point",value:"12",url:"data/trafficMonitor/roadGridMgr/zadao.json",height:165,width:530,href:"tpls/trafficMonitor/roadGridMgr/insertData/zadao.html"},13:{label:"高速出入口",layer:o,shpType:"point",value:"13",url:"data/trafficMonitor/roadGridMgr/churukou.json",height:260,width:530,href:"tpls/trafficMonitor/roadGridMgr/insertData/churukou.html"},14:{label:"互通立交枢纽",layer:n,shpType:"point",value:"14",url:"data/trafficMonitor/roadGridMgr/lijiao.json",height:130,width:530,href:"tpls/trafficMonitor/roadGridMgr/insertData/lijiao.html"},15:{label:"服务区",layer:l,shpType:"point",value:"15",url:"data/trafficMonitor/roadGridMgr/fuwuqu.json",height:300,width:530,href:"tpls/trafficMonitor/roadGridMgr/insertData/fuwuqu.html"},16:{label:"收费站",layer:i,shpType:"point",value:"16",url:"data/trafficMonitor/roadGridMgr/shoufeizhan.json",height:200,width:530,href:"tpls/trafficMonitor/roadGridMgr/insertData/shoufeizhan.html"},17:{label:"加油站",layer:u,shpType:"point",value:"17",url:"data/trafficMonitor/roadGridMgr/jiayouzhan.json",height:200,width:530,href:"tpls/trafficMonitor/roadGridMgr/insertData/jiayouzhan.html"},18:{label:"停车场",layer:s,shpType:"point",value:"18",url:"data/trafficMonitor/roadGridMgr/tingchechang.json",height:230,width:530,href:"tpls/trafficMonitor/roadGridMgr/insertData/tingchechang.html"}}},$("#txtRoleName").textbox({icons:[{iconCls:"icon-man",handler:function(e){$(e.data.target).textbox("clear"),a.removeAllFeatures()}}]}),$.extend(e,{initData:function(){a=new OpenLayers.Layer.Vector("vectors");var c={featureover:function(a){var t=new OpenLayers.Popup.FramedCloud("info",a.feature.geometry.getBounds().getCenterLonLat(),null,e.fieldInfo(a),null,null,null);a.feature.popup=t,h.map.addPopup(t)},featureout:function(e){e.feature.popup.hide()},afterfeaturemodified:function(a){e.openDialog(a.feature.attributes),d.deactivate(),h.map.removeControl(d),d=null},featureselected:function(e){$.messager.confirm("确认","您确认想要删除记录吗？",function(a){a&&(e.feature.popup.destroy(),e.object.removeFeatures(e.feature),d.deactivate(),h.map.removeControl(d),d=null)})}},p=new OpenLayers.StyleMap({"default":new OpenLayers.Style({fillOpacity:1,strokeOpacity:1,strokeColor:"#000000",graphicWidth:12,graphicHeight:12,externalGraphic:"frameworks/Openlayers/img/marker.png",label:"",labelXOffset:4,labelYOffset:24}),select:new OpenLayers.Style({fillOpacity:.6,strokeOpacity:.8,strokeColor:"#000000",graphicWidth:12,graphicHeight:12,externalGraphic:"frameworks/Openlayers/img/marker.png"})});t=new OpenLayers.Layer.Vector("lukou",{styleMap:p,eventListeners:c});var f=new OpenLayers.StyleMap({"default":new OpenLayers.Style({fillOpacity:1,strokeOpacity:1,graphicWidth:12,graphicHeight:12,externalGraphic:"frameworks/Openlayers/img/marker-gold.png"}),select:new OpenLayers.Style({fillOpacity:.6,strokeOpacity:.8,graphicWidth:12,graphicHeight:12,externalGraphic:"frameworks/Openlayers/img/marker-gold.png"})});r=new OpenLayers.Layer.Vector("zadao",{styleMap:f,eventListeners:c}),o=new OpenLayers.Layer.Vector("churukou",{eventListeners:c}),n=new OpenLayers.Layer.Vector("lijiao",{eventListeners:c}),l=new OpenLayers.Layer.Vector("fuwuqu",{eventListeners:c}),i=new OpenLayers.Layer.Vector("shoufeizhan",{eventListeners:c}),u=new OpenLayers.Layer.Vector("jiayouzhan",{eventListeners:c}),s=new OpenLayers.Layer.Vector("tingchechang",{eventListeners:c});var y=new OpenLayers.StyleMap({"default":new OpenLayers.Style({fillOpacity:1,strokeOpacity:1,strokeColor:"#000000",graphicWidth:24,graphicHeight:24,externalGraphic:"frameworks/easyui/themes/icons/tip.png",label:"",labelXOffset:4,labelYOffset:24}),select:new OpenLayers.Style({fillOpacity:.6,strokeOpacity:.8,strokeColor:"#000000",graphicWidth:24,graphicHeight:24,externalGraphic:"frameworks/Openlayers/img/marker-blue.png"})});a=new OpenLayers.Layer.Vector("vectors",{styleMap:y,eventListeners:c}),h.map.addLayers([t,r,o,n,l,i,u,s,a])}}),e.addFeature=function(){d&&(d.deactivate(),h.map.removeControl(d),d=null),c?("point"==p?d=new OpenLayers.Control.DrawFeature(c,OpenLayers.Handler.Point):"polyline"==p?d=new OpenLayers.Control.DrawFeature(c,OpenLayers.Handler.Path):"polygon"==p&&(d=new OpenLayers.Control.DrawFeature(c,OpenLayers.Handler.Polygon)),d.featureAdded=e.onFeature,h.map.addControl(d),d.activate()):alert("请选择目标图层！")},e.modifyFeature=function(){d&&(d.deactivate(),h.map.removeControl(d),d=null),c?(d=new OpenLayers.Control.ModifyFeature(c),h.map.addControl(d),d.activate()):alert("请选择目标图层！")},e.deleteFeature=function(){d&&(d.deactivate(),h.map.removeControl(d),d=null),c?(d=new OpenLayers.Control.SelectFeature(c,{clickout:!0,toggle:!1,multiple:!1,hover:!1,toggleKey:"ctrlKey",multipleKey:"shiftKey"}),h.map.addControl(d),d.activate()):alert("请选择目标图层！")},e.onFeature=function(a){d.deactivate(),e.openDialog(null),c.addFeatures(a)},e.searchFeature=function(){a.removeAllFeatures();var t=e.$("#txtRoleName").textbox("getText").trim();if(t){if(g)for(var r in g){var o=f[g[r].value].layer.features;if(o.length>0)for(var n in o){var l=o[n].attributes.name;if(l&&l.indexOf(t)>=0){var i=new OpenLayers.Feature.Vector(o[n].geometry.clone(),o[n].attributes);a.addFeatures(i)}}}else alert("请选择目标图层!");a.features.length>0||alert("查询结果为空!")}else alert("请输入查询内容!")},e.fieldInfo=function(e){var a=e.object.name;switch(a){case"lukou":return"<div style='font-size:1em'> 路口名称："+e.feature.attributes.name+"<br>路口类型："+e.feature.attributes.lklx+"<br>行政区划："+e.feature.attributes.xzqh+"<br>所属道路名称："+e.feature.attributes.ssdlmc+"<br>相交道路名称："+e.feature.attributes.xjdlmc+"<br>管辖机构："+e.feature.attributes.gxjg;case"zadao":return"<div style='font-size:1em'> 匝道名称："+e.feature.attributes.name+"<br>匝道类型："+e.feature.attributes.zdlx;case"churukou":return"<div style='font-size:1em'> 出入口名称："+e.feature.attributes.name+"<br>出入口目的地："+e.feature.attributes.mdd;default:return"<div style='font-size:1em'> 名称："+e.feature.attributes.name}};var g=[];e.pushcomboboxData=function(a,t){var r={label:a,value:t};if(g.length>0){var o=!0;for(var n in g)g[n].label==r.label&&g[n].value==r.value&&(o=!1);o&&g.push(r)}else g.push(r);e.$("#tagLayer").combobox("loadData",g)},e.deletecomboboxData=function(a){for(var t in g)g[t].value==a&&g.splice(t,1),e.$("#tagLayer").combobox("clear").combobox("loadData",g)},e.selectAll=function(a){var t=a.currentTarget;t.checked?e.$("input[name='layer']").each(function(){this.checked=!0,$(this).change()}):e.$("input[name='layer']").each(function(){this.checked=!1,$(this).change()})},e.addLayer=function(a){var t=a.currentTarget;t.checked?(e.pushcomboboxData(f[t.value].label,t.value),e.$ajaxRequest({url:f[t.value].url,params:{},success:function(e){f[t.value].layer.features.length>0&&f[t.value].layer.removeAllFeatures();for(var a in e){var r=y.read(e[a].wkt).geometry.clone();r.transform(h.map.displayProjection,h.map.getProjectionObject());var o=new OpenLayers.Feature.Vector(r);o.attributes=e[a],f[t.value].layer.addFeatures(o)}},fail:function(){}})):null!=f[t.value].layer&&(e.deletecomboboxData(f[t.value].value),f[t.value].layer.removeAllFeatures())},e.openDialog=function(a){var t;e.$("#tagLayer").combobox("getValue")?t=f[e.$("#tagLayer").combobox("getValue")]:alert("请选择目标图层！"),e.$setParam("newData",a),e.$setParam("closeSelf",function(){e.$getDialog("createDialog").dialog("close")}),e.$openDialog("createDialog",{title:"属性信息",height:t.height,width:t.width,href:t.href},!0)}});</script><style>#cc .th{width:80px;text-align:right;height:23px;line-height:23px;font-weight:700}#cc .td{width:70px;text-align:left}</style>