<div class="easyui-layout" id="faultAlarm"><div data-options="region:'north',border:false"><form method="post" cy-form="formData"><div class="table"><div class="tr"><div class="td" style="padding-left:5px">所属机构：</div><div class="td"><select class="easyui-combotree" id="orgCode" name="orgCode" style="width:150px"></select></div><div class="td" style="padding-left:5px">设备类型：</div><div class="td"><input class="easyui-combobox" id="devType" name="devType" data-options="valueField:'id',textField:'text'" style="width:150px"></div><div class="td" style="padding-left:5px">所属道路：</div><div class="td"><input class="easyui-combobox" id="roadCode" name="roadCode" style="width:150px" data-options="valueField:'id',textField:'text'"></div><div class="td"><input type="checkbox" name="checkbox" checked="true" value="checkbox1"> 有效 <input type="checkbox" name="checkbox" value="checkbox2"> 无效</div></div><div class="tr"><div class="td" style="padding-left:5px">故障类型：</div><div class="td"><input class="easyui-combobox" id="faultType" name="faultType" style="width:150px" data-options="valueField:'id',textField:'text'" style="width:150px"></div><div class="td" style="padding-left:5px">设备厂商：</div><div class="td"><input class="easyui-combobox" id="devComp" name="devComp" style="width:150px" data-options="valueField:'id',textField:'text'" style="width:150px"></div><div class="td" style="padding-left:5px">发生时间：</div><div class="td"><input class="easyui-datetimebox" style="width:150px"></div><div class="td" style="padding-left:5px">至：</div><div class="td"><input class="easyui-datetimebox" style="width:150px"></div></div><div class="tr"><div class="td" style="padding-left:5px"><a class="easyui-linkbutton button-search" style="width:60px" iconcls="icon-search" cy-click="searchData">查询</a></div><div class="td" style="padding-left:5px"><a class="easyui-linkbutton button-add" data-options="iconCls:'icon-add',plain:true" cy-click="addData">新增</a></div><div class="td" style="padding-left:5px"><a class="easyui-linkbutton button-edit" data-options="iconCls:'icon-edit',plain:true" cy-click="addData">修改</a></div><div class="td" style="padding-left:5px"><a href="javascript:void(0)" class="easyui-linkbutton button-drop" data-options="iconCls:'icon-clear',plain:true" cy-click="deleteFault">删除</a></div><div class="td" style="padding-left:5px"><a href="javascript:void(0)" class="easyui-linkbutton button-save" data-options="iconCls:'icon-reload',plain:true" cy-click="">导出</a></div><div class="td" style="padding-left:5px"><a class="easyui-linkbutton button-remove" style="width:90px" cy-click="maintenance">生成维护单</a></div></div><div class="tr"><div id="button" class="td" style="display:none"><a href="javascript:void(0)" class="easyui-linkbutton button-enable" cy-click="comfirmSure">有效</a> <a href="javascript:void(0)" class="easyui-linkbutton button-disable" cy-click="comfirmSure">无效</a></div></div></div></form></div><div data-options="region:'center',border:true"><table cy-datagrid="options" id="dgv" cy-querydata="formData" cy-url="data/deviceManage/dataFault.json"></table></div></div><script type="text/javascript">InitPage([],function(t){function e(){t.$("#roadCode").combobox("loadData",i.T_DIC_ROAD),t.$("#faultType").combobox("loadData",i.T_DIC_FAULT),t.$("#devType").combobox("loadData",i.T_DIC_DEV),t.$("#devComp").combobox("loadData",i.T_DIC_COMP),t.$(".easyui-datetimebox").datetimebox("setValue",(new Date).format("yyyy-MM-dd hh:mm:ss"))}function a(){t.$getDialog("fault_Info").dialog("close")}function o(){t.$getDialog("maintenance_info").dialog("close")}var i=[];t.$ajaxRequest({url:"data/deviceManage/chooseInit.json",params:{OrgCode:t.UserInfo.OrgCode},success:function(a){i=a.dicts,e(),t.$("#orgCode").combotree("loadData",a.district_tree)},fail:function(t){alert(t)}}),$.extend(t,{formData:{},changeData:function(t){return t+=1},searchData:function(){t.$search("formData",{},function(t){})},options:{columns:[[{field:"id",checkbox:!0},{title:"发生时间",field:"START_TIME",width:10},{title:"结束时间",field:"END_TIME",width:10},{title:"设备编号",field:"DEVICE_ID",width:10},{title:"设备名称",field:"DEVICE_NAME",width:10},{title:"所属机构",field:"ORG_CODE",width:10},{title:"安装点位",field:"SITE_CODE",width:10},{title:"在线/离线",field:"REPAIR_TIME",width:10},{title:"故障/报警",field:"FAULT_ALARM",width:10},{title:"故障/报警类型",field:"FAULT_TYPE",width:10},{title:"采集方式",field:"COLLECT_METHOD",width:10},{title:"描述",field:"REMARK",width:10},{title:"处理状态",field:"PROCESS_STATE",width:10},{title:"有效/无效",field:"IS_VALIDITY",width:10,formatter:function(e,a){return"有效"==e?(t.$("#button").find("a").eq(0).show(),t.$("#button").find("a").eq(1).hide(),t.$("#button").html()):(t.$("#button").find("a").eq(0).hide(),t.$("#button").find("a").eq(1).show(),t.$("#button").html())}}]],rowStyler:function(t,e){return"无效"==e.IS_VALIDITY?"background-color:#E5E5E5;color:#black;font-weight:normal;":void 0}},addData:function(e){console.log(e.target);var o={orgCode:$("#orgCode").val(),roadCode:"123456",faultType:1};t.$setParam("paramData",o),t.$setParam("close_fault",a),t.$openDialog("fault_Info",{width:720,height:240,title:"故障信息",href:"tpls/deviceManage/deviceMaintenance/faultInfo[手工添加故障].html"})},deleteFault:function(e){var a=t.$("#dgv").datagrid("getChecked");if($.isEmptyObject(a))console.log("您未选中任何记录");else{for(var o=0;o<a.length;o++)console.log(a[o].DEVICE_ID);t.searchData()}},maintenance:function(e){console.log(e.target);var a={orgCode:"d",roadCode:"123456",faultType:1};t.$setParam("paramData",a),t.$setParam("close_maintenance",o),t.$openDialog("maintenance_info",{width:750,height:320,title:"报警信息",href:"tpls/deviceManage/deviceMaintenance/faultComboInfo[生成维护单].html"})},comfirmSure:function(e){var a=t.$("#dgv").datagrid("getSelected");$.isEmptyObject(a)&&console.log("您未选中任何记录"),console.log("aaaaaa")}})},function(t){});</script><style type="text/css">body{font:12px/20px "微软雅黑","宋体",Arial,sans-serif,Verdana,Tahoma;padding:0;margin:0}fieldset{border:#ddd solid 1px;padding:0 10px 0 10px;margin-bottom:10px}fieldset legend{color:#2A6496;font-size:12px;background:#fff;border-bottom:0;width:auto;margin-bottom:0}</style>