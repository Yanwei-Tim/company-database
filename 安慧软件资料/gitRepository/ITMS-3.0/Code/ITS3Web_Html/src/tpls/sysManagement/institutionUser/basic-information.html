<!-- 机构信息面板-->
<div id="basicInformation_add" class="easyui-layout">
<!--
    <div data-options="region:'north',title:'北部',collapsible:true" style="height: 250px;">
        <div class="easyui-layout">
            <div data-options="region:'center'"> </div>
            <div data-options="region:'east',title:'东'" style="width: 250px;"></div>

        </div>
    </div>
    <div data-options="region:'center',title:'中部',collapsible:true,split:true"></div>
-->
<form cy-form="InformationData">
<!--<div data-options="region:'north'" style="height: 310px;">-->
    <div class="searchPanel">
    <div class="panel_title">基本信息</div>
    <div class="table">
        <div class="tr">
            <div class="th">机构代码：</div>
            <div class="td">
                <input type="text" name="jgdm" class="easyui-textbox">
            </div>
            <div class="th" style="width: 110px;"> 机构名称：</div>
            <div class="td">
                <input type="text" name="jgmc" class="easyui-textbox" style="width:140px;">
            </div>
            <div class="th" style="width: 120px;"> 机构级别：</div>
            <div class="td">
                <select name="jcjb" class="easyui-combobox" style="width: 110px;"></select>
            </div>
        </div>
        <div class="tr">
            <div class="th">父机构名称：</div>
            <div class="td">
                <select name="fjgmc" class="easyui-combobox" style="width: 132px;"></select>
            </div>
            <div class="th">业务指导机构：</div>
            <div class="td">
                <select type="text" name="ywzdjg" class="easyui-combobox" style="width: 140px;"></select>
            </div>
            <div class="th" style="width: 120px;">机构类型：</div>
            <div class="td">
                <select name="jglx" class="easyui-combobox" style="width: 110px;"></select>
            </div>
        </div>
        <div class="tr">
            <div class="th">机构负责人：</div>
            <div class="td">
                <input type="text" name="jgfzr" class="easyui-textbox">
            </div>

            <div class="th" style="width: 110px;"> 负责人电话：</div>
            <div class="td">
                <select name="jglxrdh" class="easyui-textbox" style="width: 140px;"></select>
            </div>
            <div class="th" style="width: 120px;"> 机构联系人电话：</div>
            <div class="td">
                <select name="jglxrdh" class="easyui-textbox" style="width: 110px;"></select>
            </div>
        </div>
        <div class="tr">
            <div class="td" style="width:64%;height:80px;">
                    <div class="tr">
                        <div class="th">辖区范围：</div>
                        <div class="td">
                            <select name="xqfw" class="easyui-combobox" style="width: 133px;"></select>
                         </div>
                        <div class="th">启用状态：</div>
                        <div class="td">&nbsp;&nbsp;&nbsp;&nbsp;
                            是<input type="radio" name="qyzt" value="是"/>
                            否<input type="radio" name="qyzt" value="否"/>
                        </div>
                    </div>
                    <div class="tr">
                        <div class="th" style="width: 120px;">是否是独立机构：</div>
                        <div class="td">&nbsp;
                            是<input type="radio" name="bm" value="是"/>
                            否<input type="radio" name="bm" value="否"/>
                        </div>
                        <div class="th" style="width: 180px;">是否是高速管理部门：</div>
                        <div class="td">&nbsp;
                            是<input type="radio" name="gsglbm" value="是"/>
                            否<input type="radio" name="gsglbm" value="否"/>
                        </div>
                    </div>
                    <div class="tr">
                        <div class="th">备注：</div>
                        <div class="td" style="">
                            <input name="bz" class="easyui-textbox" style="width: 375px;height: 30px;"/>
                        </div>
                    </div>
            </div>
            <!--<div class="td" style="width:32%;height:80px;">-->
                    <!--<div class="tr">-->
                        <!--<div class="th">启用状态：</div>-->
                        <!--<div class="td">&nbsp;&nbsp;&nbsp;&nbsp;-->
                            <!--是<input type="radio" name="qyzt" value="是"/>-->
                            <!--否<input type="radio" name="qyzt" value="否"/>-->
                        <!--</div>-->
                    <!--</div>-->
                    <!--<div class="tr">-->
                        <!--<div class="th" style="width: 130px;">是否是高速管理部门：</div>-->
                        <!--<div class="td">&nbsp;-->
                            <!--是<input type="radio" name="gsglbm" value="是"/>-->
                            <!--否<input type="radio" name="gsglbm" value="否"/>-->
                        <!--</div>-->
                    <!--</div>-->

            <!--</div>-->
            <div class="td" style="width:36%;height:140px;">

                <img src="themes/default/images/jgqz.jpg"/>
                    <!--<div class="searchPanel" style="width: 97%;height: 86%">-->
                        <!--<!--<div class="panel_title">机构签章</div>-->
                    <!--</div>-->

            </div>
        </div>
    </div>

</div>
 <!--</div>-->
<!--<div data-options="region:'center'" style="height: 200px;">-->
 <div class="searchPanel">
    <div class="panel_title">地址信息</div>
    <div class="table">
        <div class="tr">
            <div class="td" style="width: 32%;height: 140px;">
                <div class="tr">
                    <div class="th">驻地所在城市：</div>
                    <div class="td">
                        <select name="zdszcs" class="easyui-combobox" style="width:120px;"></select>
                    </div>
                </div>
                <div class="tr">
                    <div class="th">驻地行政区划：</div>
                    <div class="td">
                        <select name="zdxzqh" class="easyui-combobox" style="width: 120px;"></select>
                    </div>
                </div>
                <div class="tr">
                    <div class="th">驻地地址：</div>
                    <div class="td">
                        <input name="zddz" class="easyui-textbox" style="width:120px;"/>
                    </div>
                </div>
            </div>
            <div class="td" style="width: 42%;height: 140px;">
                <div class="tr">
                    <div class="th" style="width: 50px;">经度：</div>
                    <div class="td">
                        <input id="jd" name="wd" class="easyui-textbox" style="width: 100px;"/>
                    </div>
                    <div class="td">
                        <input id="wd" name="d" class="easyui-textbox" style="width: 40px;"/>度
                    </div>
                    <div class="td">
                        <input name="f" class="easyui-textbox" style="width: 40px;"/>分
                    </div>
                    <div class="td">
                        <input name="m" class="easyui-textbox" style="width: 40px;"/>秒
                    </div>
                </div>
                <div class="tr">
                    <div class="th"  style="width: 50px;">纬度：</div>
                    <div class="td">
                        <input name="wd" class="easyui-textbox" style="width: 100px;"/>
                    </div>
                    <div class="td">
                        <input name="d" class="easyui-textbox" style="width: 40px;"/>度
                    </div>
                    <div class="td">
                        <input name="f" class="easyui-textbox" style="width: 40px;"/>分
                    </div>
                    <div class="td">
                        <input name="m" class="easyui-textbox" style="width: 40px;"/>秒
                    </div>
                </div>
                <div class="tr">
                    <div class="td">
                        <a class="easyui-linkbutton button-add" data-options="iconCls:'icon-add'"
                           cy-click="addJw" style="width: 60px;">选取</a>
                    </div>
                </div>
            </div>
            <div class="td" style="width:26%;height:140px;">
                <div id="map"style="height:100%;width:100%" >
                 <!--<div class="searchPanel" style="width: 97%;height: 86%">-->
                        <!--<div class="panel_title">地图</div>-->
                 <!--</div>-->
            </div>

       </div>
        </div>
    </div>
</div>
<div class="tr">
    <div class="td" style="text-align: center">
        <a class="easyui-linkbutton button-save" data-options="iconCls:'icon-save'"
           cy-click="save">保存</a>
        <a class="easyui-linkbutton button-close" data-options="iconCls:'icon-close'"
           cy-click="$closeSelf">取消</a>
    </div>
</div>
<!--
            <div class="tr">
                <div class="td">
                    <div class="searchPanel  half">
                        <div class="panel_title">机构签章</div>
                    </div>
                </div>
                <div class="td">
                    <div class="searchPanel  half" style="text-align: right;">
                        <div class="panel_title">通知书签章</div>
                    </div>
                </div>
            </div>
            <div class="tr">
                <div class="td" style="text-align: center">
                    <a class="easyui-linkbutton button-save" data-options="iconCls:'icon-save'" cy-click="save(123)">保存</a>
                    <a class="easyui-linkbutton button-close" data-options="iconCls:'icon-close'" cy-click="closeSelf">取消</a>
                </div>
            </div>


        <!--
        <div data-options="region:'south'" style="height: 230px;">
           <div class="easyui-layout">
               <div data-options="region:'center'" style="border: solid 0px #ddd">
               </div>
               <div data-options="region:'east'" style="width: 50%;border-top: solid 0px #ddd;border-right: solid 0px #ddd;
               border-bottom: solid 0px #ddd"></div>
           </div>
        </div>
            -->
<!--<div class="searchPanel">
    <div class="panel_title ">地址信息</div>
    <div id="dz" class="table">
        <div class="tr">
            <div class="th">驻地所在城市：</div>
            <div class="td">
                <select name="zdszcs" class="easyui-combobox" style="width: 125px;"></select>
            </div>
            <div class="th" style="width: 130px;">驻地行政区划：</div>
            <div class="td">
                <select name="zdxzqyhf" class="easyui-combobox" style="width: 115px;"></select>
            </div>
        </div>
        <div class="tr">
            <div class="th">经度：</div>
            <div class="td">
                <input id="jd" type="text" name="wd" class="easyui-textbox" style="width: 110px;">
            </div>
            <div class="td" id="dmfJd" style="width:120px;"></div>
            <div class="th" >纬度：</div>
            <div class="td">
                <input id="wd" type="text" name="jw" class="easyui-textbox" style="width: 110px;">
            </div>
            <div class="td" id="dmfWd" style="widht:110px;"></div>
            <div class="td">
                <a class="easyui-linkbutton button-add" data-options="iconCls:'icon-add'"
                        cy-click="addJw" style="width: 60px;">选取</a>
            </div>
        </div>
        <div class="tr">
            <div class="th">驻地地址：</div>
            <div class="td">
                <input  type="text" name="zddz" class="easyui-textbox" style="width: 120px;">
            </div>
        </div>
    </div>
</div>

<div class="tr">
    <div class="td">
        <div class="searchPanel  half">
            <div class="panel_title">机构签章</div>
        </div>
    </div>
    <div class="td">
        <div class="searchPanel  half" style="text-align: right;">
            <div class="panel_title">通知书签章</div>
        </div>
    </div>
</div>
<div class="tr">
    <div class="td" style="text-align: center">
        <a class="easyui-linkbutton button-save" data-options="iconCls:'icon-save'" cy-click="save(123)">保存</a>
        <a class="easyui-linkbutton button-close" data-options="iconCls:'icon-close'" cy-click="closeSelf">取消</a>
    </div>
</div>
-->
<!-- <div data-options="region:'center'">
     <div class="easyui-layout">
         <div data-options="region:'west',title:'地址信息',collapsible:false,border:false,width:'50%'"
              style="border-right: solid 1px #ddd">
             <div id="dz" class="table">
                 <div class="tr">
                     <div class="th">驻地所在城市：</div>
                     <div class="td">
                         <select name="zdszcs" class="easyui-combobox" style="width: 125px;"></select>
                     </div>
                     <div class="tr">
                         <div class="th" style="width: 130px;">驻地行政区划：</div>
                         <div class="td">
                             <select name="zdxzqyhf" class="easyui-combobox" style="width: 115px;"></select>
                         </div>
                     </div>
                 </div>
                 <div class="tr">
                     <div class="th">驻地地址：</div>
                     <div class="td">
                         <input type="text" name="zddz" class="easyui-textbox" style="width: 120px;">
                     </div>
                 </div>
                 <div class="tr">
                     <div class="th">经度：</div>
                     <div class="td">
                         <input id="jd" type="text" name="wd" class="easyui-textbox" style="width: 110px;">
                     </div>
                     <div class="td" id="dmfJd" style="width:120px;"></div>
                     <div class="th">纬度：</div>
                     <div class="td">
                         <input id="wd" type="text" name="jw" class="easyui-textbox" style="width: 110px;">
                     </div>
                     <div class="td" id="dmfWd" style="widht:110px;"></div>
                     <div class="td">
                         <a class="easyui-linkbutton button-add" data-options="iconCls:'icon-add'"
                            cy-click="addJw" style="width: 60px;">选取</a>
                     </div>
                 </div>

             </div>
         </div>
         <div data-options="region:'center',title:'机构签章',border:false">
             <div id=""></div>
         </div>
     </div>
 </div>
 -->


</form>

</div>

<script>
    //接受数据
    InitPage(["InformationData", "closeSelf","choose"], function ($scope) {

        var cyMap = new CYMap($scope.$("#map")[0]);
        //中心点坐标
        var centerPoint=new OpenLayers.LonLat(105.70045,28.58540);
        var markers;

        $scope.load=function(){
            initMap();
        }
        /**
         * 地图平移至中心点
         */
        function moveToCenterPoint() {
            centerPoint.transform(cyMap.map.displayProjection, cyMap.map.getProjectionObject());
            cyMap.map.panTo(centerPoint);
        }
        function initMap(){
            cyMap.map.events.register("click", map, onMapClick);
            pointLayer=new OpenLayers.Layer.Vector("point");
            markers=new OpenLayers.Layer.Markers("Markers");

            cyMap.map.addLayer(markers);
        }

        function onMapClick(e){
            // 显示地图屏幕坐标
            //var str = "[Screen]:" + e.xy.x + "," + e.xy.y;
            // 屏幕坐标向地图坐标的转换
            markers.clearMarkers();
            var lonlat = cyMap.map.getLonLatFromViewPortPx(e.xy);
            var pIcon= new OpenLayers.Icon("frameworks/Openlayers/img/marker.png", new OpenLayers.Size(16, 16), new OpenLayers.Pixel(-8, -8));
            var markerLoc = new OpenLayers.Marker(lonlat, pIcon.clone());

            markers.addMarker(markerLoc);
            lonlat.transform(cyMap.map.getProjectionObject(),cyMap.map.displayProjection);
            console.log(lonlat);
            $scope.choose(lonlat.lon,lonlat.lat);
            $scope.$destroySelf();
        }

        //添加经纬度信息
        $scope.addJw = function () {
            //设置关闭按钮
            $scope.$setParam("close", function () {
                $scope.$getDialog("jwDialog").dialog("close");
            });
            $scope.$setParam("choose", function (jd, wd) {
                $scope.$('#jd').textbox('setValue', Math.round(jd * 1000000) / 1000000);
                $scope.$('#dmfJd').text(changeLonlat(jd));
                $scope.$('#wd').textbox('setValue', Math.round(wd * 1000000) / 1000000);
                $scope.$('#dmfWd').text(changeLonlat(wd));
            });

            $scope.$openDialog("jwDialog", {
                title: "地图",
                width: 900,
                height: 650,
                href: "tpls/sysManagement/institutionUser/institution-map.html"
            });
        };
        //保存按钮
        $scope.save = function (event) {
            console.log(event);
            if ($scope.$params["type"] == "add") {

            } else {

            }
        };
        /**
         * 经纬度换算
         * @param lonlat 经纬度数值
         * @returns 度分秒字符串
         */
        function changeLonlat(lonlat) {
            var d = parseInt(lonlat);
            var f = (parseFloat(lonlat) - parseInt(lonlat)) * 60;
            var m = (f - parseInt(f)) * 60;
            return d + "度" + parseInt(f) + "分" + Math.round(m * 1000) / 1000 + "秒";
        }

    })

</script>
<style type="text/css">
    /*机构签章和通知签章样式*/
    #basicInformation_add .half {
        float: left;
        width: 47%;
        height: 160px;
    }

    /*表头样式*/
    #basicInformation_add .th {
        width: 110px;
        text-align: right;
    }
</style>

